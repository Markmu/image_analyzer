# Story 2-1 æµ‹è¯•è¦†ç›–ç‡é—®é¢˜è¡¥å……æŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ:** 2026-02-09
**æŠ¥å‘Šç±»å‹:** æµ‹è¯•è´¨é‡åˆ†æ
**ä¸¥é‡ç¨‹åº¦:** ğŸš¨ P0 - é˜»å¡æ€§é—®é¢˜

---

## âŒ é—®é¢˜æ¦‚è¿°

**Story 2-1æµ‹è¯•è¦†ç›–ç‡ä¸¥é‡ä¸è¶³ï¼Œä¸ç¬¦åˆYOLOæ¨¡å¼è¦æ±‚**

---

## ğŸ“Š æµ‹è¯•ç°çŠ¶

### E2Eæµ‹è¯• âœ…
```
âœ… 6/6 æµ‹è¯•é€šè¿‡ (100%)
æ–‡ä»¶: tests/e2e/image-upload.spec.ts
åœºæ™¯:
  - TEST-001: æœ‰æ•ˆå›¾åƒä¸Šä¼ 
  - TEST-002: æ— æ•ˆæ–‡ä»¶ç±»å‹é”™è¯¯
  - TEST-003: æ–‡ä»¶è¿‡å¤§é”™è¯¯
  - TEST-004: æ‹–æ”¾ä¸Šä¼ 
  - TEST-005: åˆ†æç»“æœæ˜¾ç¤º
  - TEST-006: ä¿å­˜ä¸ºæ¨¡æ¿
```

### å•å…ƒæµ‹è¯• âŒ
```
âŒ 0/3 æ ¸å¿ƒæ–‡ä»¶æœªæµ‹è¯•
ç¼ºå¤±çš„æµ‹è¯•æ–‡ä»¶:
  - src/app/api/upload/__tests__/route.test.ts (ä¸å­˜åœ¨)
  - src/features/analysis/components/ImageUploader/__tests__/ImageUploader.test.tsx (ä¸å­˜åœ¨)
  - src/lib/r2/__tests__/upload.test.ts (ä¸å­˜åœ¨)
```

---

## ğŸ“ˆ è¦†ç›–ç‡è¯¦ç»†æ•°æ®

### Story 2-1ä¸“ç”¨è¦†ç›–ç‡: 0%

| æ–‡ä»¶ | è¡Œæ•° | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|------|--------|------|
| `src/app/api/upload/route.ts` | 212 | 0% | âŒ æœªæµ‹è¯• |
| `src/features/analysis/components/ImageUploader/ImageUploader.tsx` | 223 | 0% | âŒ æœªæµ‹è¯• |
| `src/lib/r2/upload.ts` | ~150 | 0% | âŒ æœªæµ‹è¯• |
| `src/lib/r2/delete.ts` | 266 | 0% | âŒ æœªæµ‹è¯• |
| `src/lib/db/schema.ts` | - | 82.35% | âœ… è¢«Epic 1è¦†ç›– |

### æ€»ä½“è¦†ç›–ç‡: 27.29%
**æ³¨æ„:** è¿™ä¸ªæ•°å­—åŒ…å«äº†æ‰€æœ‰Epic 1çš„ä»£ç ï¼Œä¸èƒ½åæ˜ Story 2-1çš„çœŸå®æƒ…å†µã€‚

---

## ğŸ¯ YOLOæ¨¡å¼ç¬¦åˆæ€§åˆ†æ

| è¦æ±‚ | ç›®æ ‡ | å®é™… | å·®è· | çŠ¶æ€ |
|------|------|------|------|------|
| å•å…ƒæµ‹è¯•æ•°é‡ | 2-3ä¸ªæ ¸å¿ƒåœºæ™¯ | 0ä¸ª | -2~-3 | âŒ |
| E2Eæµ‹è¯•æ•°é‡ | 1ä¸ªä¸»è¦æµç¨‹ | 6ä¸ªåœºæ™¯ | +5 | âœ… |
| ä»£ç è¦†ç›–ç‡ | â‰¥70% | 0% | -70% | âŒ |
| **æ€»ä½“ç¬¦åˆåº¦** | - | - | - | **âŒ ä¸ç¬¦åˆ** |

---

## ğŸš¨ é£é™©è¯„ä¼°

### é«˜é£é™© ğŸ”´

1. **æ ¸å¿ƒAPIæœªæµ‹è¯•**
   - æ–‡ä»¶éªŒè¯é€»è¾‘æœªæµ‹è¯•
   - é”™è¯¯å¤„ç†æœªæµ‹è¯•
   - è¾¹ç•Œæ¡ä»¶æœªæµ‹è¯•
   - å¯èƒ½å¯¼è‡´ç”Ÿäº§ç¯å¢ƒbug

2. **ç»„ä»¶æœªæµ‹è¯•**
   - æ‹–æ‹½ä¸Šä¼ é€»è¾‘æœªæµ‹è¯•
   - è¿›åº¦æ›´æ–°æœªæµ‹è¯•
   - å–æ¶ˆåŠŸèƒ½æœªæµ‹è¯•
   - ç”¨æˆ·ä½“éªŒé—®é¢˜å¯èƒ½æœªå‘ç°

3. **R2é›†æˆæœªæµ‹è¯•**
   - ä¸Šä¼ å‡½æ•°æœªæµ‹è¯•
   - é”™è¯¯å¤„ç†æœªæµ‹è¯•
   - å¯èƒ½å¯¼è‡´ä¸Šä¼ å¤±è´¥

### ä¸­é£é™© ğŸŸ¡

4. **ç¼ºå°‘å›å½’ä¿æŠ¤**
   - ä»£ç å˜æ›´æ—¶ç¼ºå°‘è‡ªåŠ¨åŒ–ä¿æŠ¤
   - é‡æ„æ—¶å®¹æ˜“å¼•å…¥bug

5. **æ–‡æ¡£ä»·å€¼é™ä½**
   - å•å…ƒæµ‹è¯•åº”è¯¥æ˜¯æœ€ä½³æ–‡æ¡£
   - ç¼ºå°‘æµ‹è¯•ä½¿ä»£ç éš¾ä»¥ç†è§£

---

## ğŸ’¡ å¿…é¡»è¡¥å……çš„æµ‹è¯•

### ä¼˜å…ˆçº§P0 (é˜»å¡)

#### 1. APIè·¯ç”±æµ‹è¯•
**æ–‡ä»¶:** `tests/api/upload.test.ts`

```typescript
describe('POST /api/upload', () => {
  it('åº”è¯¥æ‹’ç»æœªè®¤è¯ç”¨æˆ·', async () => {})
  it('åº”è¯¥æ‹’ç»æ— æ•ˆæ–‡ä»¶æ ¼å¼', async () => {})
  it('åº”è¯¥æ‹’ç»è¿‡å¤§æ–‡ä»¶(>10MB)', async () => {})
  it('åº”è¯¥æ‹’ç»è¿‡å°åˆ†è¾¨ç‡(<200x200)', async () => {})
  it('åº”è¯¥æˆåŠŸä¸Šä¼ æœ‰æ•ˆå›¾ç‰‡', async () => {})
  it('åº”è¯¥ä¿å­˜å›¾ç‰‡å…ƒæ•°æ®åˆ°æ•°æ®åº“', async () => {})
  it('åº”è¯¥è¿”å›å›¾ç‰‡URL', async () => {})
})
```

**é¢„è®¡è¦†ç›–ç‡:** 60-70%
**é¢„è®¡æ—¶é—´:** 2-3å°æ—¶

#### 2. ç»„ä»¶æµ‹è¯•
**æ–‡ä»¶:** `tests/unit/features/analysis/components/ImageUploader/ImageUploader.test.tsx`

```typescript
describe('ImageUploader', () => {
  it('åº”è¯¥æ¸²æŸ“æ‹–æ”¾åŒºåŸŸ', async () => {})
  it('åº”è¯¥å¤„ç†æ–‡ä»¶é€‰æ‹©', async () => {})
  it('åº”è¯¥æ˜¾ç¤ºä¸Šä¼ è¿›åº¦', async () => {})
  it('åº”è¯¥å…è®¸å–æ¶ˆä¸Šä¼ ', async () => {})
  it('åº”è¯¥æ˜¾ç¤ºæˆåŠŸçŠ¶æ€', async () => {})
  it('åº”è¯¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', async () => {})
})
```

**é¢„è®¡è¦†ç›–ç‡:** 50-60%
**é¢„è®¡æ—¶é—´:** 2-3å°æ—¶

#### 3. R2ä¸Šä¼ æµ‹è¯•
**æ–‡ä»¶:** `tests/unit/lib/r2/upload.test.ts`

```typescript
describe('uploadToR2', () => {
  it('åº”è¯¥ä¸Šä¼ æ–‡ä»¶åˆ°R2', async () => {})
  it('åº”è¯¥ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å', async () => {})
  it('åº”è¯¥å¤„ç†ä¸Šä¼ å¤±è´¥', async () => {})
  it('åº”è¯¥è¿”å›å…¬å…±URL', async () => {})
})
```

**é¢„è®¡è¦†ç›–ç‡:** 70-80%
**é¢„è®¡æ—¶é—´:** 1-2å°æ—¶

**æ€»è®¡é¢„è®¡æ—¶é—´:** 5-8å°æ—¶
**é¢„è®¡æ€»è¦†ç›–ç‡:** 65-75% (è¾¾æ ‡)

---

## ğŸ“‹ è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³æ‰§è¡Œ (P0)

**æ–¹æ¡ˆA: ç«‹å³è¡¥å……æµ‹è¯•**
- ä¼˜ç‚¹: ç¬¦åˆYOLOè¦æ±‚ï¼Œè´¨é‡ä¿è¯
- ç¼ºç‚¹: éœ€è¦5-8å°æ—¶é¢å¤–æ—¶é—´
- å»ºè®®: **æ¨è**

**æ–¹æ¡ˆB: æ ‡è®°ä¸ºæŠ€æœ¯å€ºåŠ¡**
- ä¼˜ç‚¹: ç«‹å³è¿›å…¥ä¸‹ä¸€ä¸ªStory
- ç¼ºç‚¹: è´¨é‡é£é™©ï¼ŒæŠ€æœ¯å€ºåŠ¡ç´¯ç§¯
- å»ºè®®: ä¸æ¨è

**æ–¹æ¡ˆC: é™ä½éªŒæ”¶æ ‡å‡†**
- ä¼˜ç‚¹: å¿«é€Ÿå®Œæˆ
- ç¼ºç‚¹: è¿åYOLOæ¨¡å¼å®šä¹‰
- å»ºè®®: ä¸å¯æ¥å—

### æ¨èæ‰§è¡Œæ–¹æ¡ˆ

**Phase 1: APIæµ‹è¯• (2-3å°æ—¶)**
```bash
# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
touch tests/api/upload.test.ts

# å®ç°æµ‹è¯•
# - æµ‹è¯•è®¤è¯
# - æµ‹è¯•æ–‡ä»¶éªŒè¯
# - æµ‹è¯•æ•°æ®åº“ä¿å­˜

# è¿è¡Œæµ‹è¯•
npm run test:run -- tests/api/upload.test.ts
```

**Phase 2: ç»„ä»¶æµ‹è¯• (2-3å°æ—¶)**
```bash
# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
touch tests/unit/features/analysis/components/ImageUploader/ImageUploader.test.tsx

# å®ç°æµ‹è¯•
# - æµ‹è¯•æ‹–æ”¾
# - æµ‹è¯•è¿›åº¦
# - æµ‹è¯•å–æ¶ˆ

# è¿è¡Œæµ‹è¯•
npm run test:run -- ImageUploader.test.tsx
```

**Phase 3: R2æµ‹è¯• (1-2å°æ—¶)**
```bash
# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
touch tests/unit/lib/r2/upload.test.ts

# å®ç°æµ‹è¯•
# - Mock S3Client
# - æµ‹è¯•ä¸Šä¼ é€»è¾‘
# - æµ‹è¯•é”™è¯¯å¤„ç†

# è¿è¡Œæµ‹è¯•
npm run test:run -- upload.test.ts
```

**Phase 4: éªŒè¯è¦†ç›–ç‡**
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:run -- --coverage

# æ£€æŸ¥Story 2-1ä¸“ç”¨è¦†ç›–ç‡
# ç›®æ ‡: â‰¥70%
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### å¿…é¡»è¾¾æˆ
- [ ] APIè·¯ç”±æµ‹è¯•è¦†ç›–ç‡ â‰¥60%
- [ ] ç»„ä»¶æµ‹è¯•è¦†ç›–ç‡ â‰¥50%
- [ ] R2æµ‹è¯•è¦†ç›–ç‡ â‰¥70%
- [ ] **æ€»ä½“è¦†ç›–ç‡ â‰¥70%**
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

### æœŸæœ›è¾¾æˆ
- [ ] æµ‹è¯•æ–‡æ¡£å®Œæ•´
- [ ] è¾¹ç•Œæ¡ä»¶è¦†ç›–
- [ ] é”™è¯¯åœºæ™¯è¦†ç›–

---

## ğŸ“Š é¢„æœŸæˆæœ

### è¡¥å……æµ‹è¯•å
```
âœ… å•å…ƒæµ‹è¯•: 12-15ä¸ª (è¾¾æ ‡)
âœ… E2Eæµ‹è¯•: 6ä¸ª (è¶…æ ‡)
âœ… è¦†ç›–ç‡: 70-75% (è¾¾æ ‡)
âœ… YOLOæ¨¡å¼: å®Œå…¨ç¬¦åˆ
```

### è´¨é‡æå‡
- **å®‰å…¨æ€§:** æ ¸å¿ƒé€»è¾‘ç»è¿‡éªŒè¯
- **å¯ç»´æŠ¤æ€§:** æµ‹è¯•ä½œä¸ºæ–‡æ¡£
- **ç¨³å®šæ€§:** å›å½’ä¿æŠ¤å»ºç«‹
- **ç¬¦åˆæ€§:** æ»¡è¶³YOLOè¦æ±‚

---

## ğŸ”„ åç»­é¢„é˜²æªæ–½

### æµç¨‹æ”¹è¿›

**Phase 4å¢å¼º:**
```typescript
async function phase4_VerifyTests() {
  // 1. è¿è¡ŒE2Eæµ‹è¯•
  const e2eResults = await runE2ETests()
  assert(e2eResults.passed === e2eResults.total, 'E2Eæµ‹è¯•æœªå…¨éƒ¨é€šè¿‡')

  // 2. è¿è¡Œå•å…ƒæµ‹è¯•
  const unitResults = await runUnitTests()
  assert(unitResults.passed === unitResults.total, 'å•å…ƒæµ‹è¯•æœªå…¨éƒ¨é€šè¿‡')

  // 3. æ£€æŸ¥è¦†ç›–ç‡
  const coverage = await getCoverageReport()
  assert(coverage.lines >= 70, `è¦†ç›–ç‡ä¸è¶³70%: ${coverage.lines}%`)

  // 4. éªŒè¯Storyä¸“ç”¨è¦†ç›–ç‡
  const storyCoverage = await getStoryCoverage('story-2-1')
  assert(storyCoverage >= 70, `Storyè¦†ç›–ç‡ä¸è¶³70%: ${storyCoverage}%`)

  return 'PASS'
}
```

**è‡ªåŠ¨åŒ–è„šæœ¬:**
```bash
#!/bin/bash
# scripts/verify-story-quality.sh

STORY_ID=$1

echo "éªŒè¯Story $STORY_ID è´¨é‡é—¨ç¦..."

# 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:run -- --coverage

# 2. æ£€æŸ¥è¦†ç›–ç‡
COVERAGE=$(cat coverage/coverage-summary.json | jq '.total.lines.pct')
if (( $(echo "$COVERAGE < 70" | bc -l) )); then
  echo "âŒ è¦†ç›–ç‡ä¸è¶³70%: $COVERAGE%"
  exit 1
fi

# 3. æ£€æŸ¥Storyä¸“ç”¨è¦†ç›–ç‡
STORY_COVERAGE=$(node scripts/get-story-coverage.js $STORY_ID)
if (( $(echo "$STORY_COVERAGE < 70" | bc -l) )); then
  echo "âŒ Storyè¦†ç›–ç‡ä¸è¶³70%: $STORY_COVERAGE%"
  exit 1
fi

echo "âœ… æ‰€æœ‰è´¨é‡é—¨ç¦é€šè¿‡"
```

---

## ğŸ“ ç»“è®º

**å½“å‰çŠ¶æ€:** âŒ Story 2-1 **ä¸ç¬¦åˆYOLOæ¨¡å¼è¦æ±‚**

**ä¸»è¦åŸå› :**
1. ç¼ºå°‘å•å…ƒæµ‹è¯•ï¼ˆåº”ä¸º2-3ä¸ªï¼Œå®é™…0ä¸ªï¼‰
2. ä»£ç è¦†ç›–ç‡0%ï¼ˆç›®æ ‡â‰¥70%ï¼‰

**å»ºè®®è¡ŒåŠ¨:**
- **ç«‹å³è¡¥å……æµ‹è¯•** (æ¨è)
- é¢„è®¡æ—¶é—´: 5-8å°æ—¶
- é¢„æœŸæˆæœ: è¦†ç›–ç‡70-75%

**ä¸è¡¥å……çš„åæœ:**
- æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯
- ç”Ÿäº§ç¯å¢ƒé£é™©
- æµç¨‹ä¿¡ç”¨å—æŸ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´:** 2026-02-09
**æŠ¥å‘Šç”Ÿæˆè€…:** Coverage-Verifier (æµ‹è¯•è´¨é‡ä¸“å®¶)
**ä¼˜å…ˆçº§:** ğŸš¨ P0 - é˜»å¡æ€§é—®é¢˜
**å»ºè®®:** ç«‹å³æ‰§è¡Œæµ‹è¯•è¡¥å……è®¡åˆ’
