# Story 0-1: 项目初始化

Status: review

## Story

As a 开发团队,
I want 拥有一个完整配置的项目骨架和开发环境,
so that 我们可以开始功能开发而不需要处理基础设施问题.

## User Outcomes

- 开发团队可以运行 `npm run dev` 并在本地访问应用
- 所有代码遵循统一的命名规范和项目结构
- 开发环境配置一致（ESLint, Prettier, Git hooks）
- CI/CD 流水线可以成功运行

## Acceptance Criteria

1. [ ] 使用 `create-next-app` 官方 CLI 成功初始化项目，包含:
   - [ ] TypeScript
   - [ ] Tailwind CSS
   - [ ] ESLint
   - [ ] App Router
   - [ ] src-dir
   - [ ] import-alias "@/\*"
2. [ ] package.json 包含所有核心依赖:
   - [ ] Drizzle ORM
   - [ ] NextAuth.js
   - [ ] React Query (TanStack Query)
   - [ ] Zustand
   - [ ] React Hook Form
   - [ ] Zod
   - [ ] MUI (Material UI)
   - [ ] AWS SDK (S3 兼容 R2)
3. [ ] 项目结构符合架构文档定义:
   - [ ] src/app/ - Next.js App Router
   - [ ] src/components/ui/ - 基础 UI 组件
   - [ ] src/components/shared/ - 共享功能组件
   - [ ] src/features/ - 按功能域组织的模块
   - [ ] src/lib/ - 库和工具
   - [ ] src/stores/ - Zustand stores
   - [ ] src/types/ - 全局类型
4. [ ] ESLint + Prettier 配置正确:
   - [ ] 代码风格一致
   - [ ] 保存时自动格式化
5. [ ] Git hooks 配置 (husky + lint-staged):
   - [ ] 提交前自动运行 lint
6. [ ] 应用可以成功构建 (`npm run build`)
7. [ ] 开发服务器可以正常启动 (`npm run dev`)

## Tasks / Subtasks

- [x] Task 1: 使用 create-next-app 初始化项目 (AC: #1)
  - [x] 1.1 运行初始化命令创建项目
  - [x] 1.2 验证项目结构符合要求
- [x] Task 2: 安装核心依赖 (AC: #2)
  - [x] 2.1 安装数据库相关 (drizzle-orm)
  - [x] 2.2 安装认证相关 (next-auth, @auth/drizzle-adapter)
  - [x] 2.3 安装状态管理 (zustand, @tanstack/react-query)
  - [x] 2.4 安装表单和验证 (react-hook-form, zod)
  - [x] 2.5 安装 UI 组件库 (@mui/material, @emotion/\*)
  - [x] 2.6 安装 AWS SDK (@aws-sdk/client-s3, @aws-sdk/lib-storage)
  - [x] 2.7 安装开发工具 (eslint, prettier, husky, lint-staged)
- [x] Task 3: 配置项目结构 (AC: #3)
  - [x] 3.1 创建目录结构 (features/, lib/, stores/, types/)
  - [x] 3.2 创建基础目录占位符
- [x] Task 4: 配置代码规范 (AC: #4, #5)
  - [x] 4.1 配置 .prettierrc
  - [x] 4.2 配置 husky pre-commit hook
  - [x] 4.3 配置 lint-staged
- [x] Task 5: 验证项目可构建 (AC: #6, #7)
  - [x] 5.1 运行 `npm run build` 验证构建
  - [x] 5.2 运行 `npm run dev` 验证开发服务器

## Dev Notes

### 核心命令

```bash
# Step 1: 初始化项目
npx create-next-app@latest image_analyzer \
  --typescript \
  --tailwind \
  --eslint \
  --app \
  --src-dir \
  --import-alias "@/*" \
  --no-turbopack

# Step 2: 安装核心依赖
npm install drizzle-orm next-auth @tanstack/react-query \
  zustand react-hook-form zod \
  @mui/material @emotion/react @emotion/styled \
  @aws-sdk/client-s3 @aws-sdk/lib-storage

# Step 3: 安装开发工具
npm install -D drizzle-kit prettier eslint-config-prettier \
  husky lint-staged
```

### 项目结构参考

完整结构见 [architecture.md](_bmad-output/planning-artifacts/architecture.md#project-structure)

```
image_analyzer/
├── src/
│   ├── app/
│   ├── components/
│   │   ├── ui/
│   │   └── shared/
│   ├── features/
│   ├── lib/
│   ├── stores/
│   ├── types/
│   └── hooks/
├── public/
└── tests/
```

### 命名规范

| 类别        | 规则             | 示例                  |
| ----------- | ---------------- | --------------------- |
| 数据库表/列 | snake_case 复数  | `users`, `created_at` |
| API 端点    | kebab-case 复数  | `/api/analysis`       |
| React 组件  | PascalCase       | `ImageUploader`       |
| 函数/变量   | camelCase        | `getAnalysisResult`   |
| 常量        | UPPER_SNAKE_CASE | `MAX_FILE_SIZE`       |
| 文件名      | kebab-case       | `image-uploader.tsx`  |

### API 响应格式

```typescript
// 成功响应
interface ApiResponse<T> {
  success: true;
  data: T;
  meta?: { page?: number; limit?: number; total?: number };
}

// 错误响应
interface ApiError {
  success: false;
  error: { code: string; message: string; details?: Record<string, unknown> };
}
```

### 依赖版本策略

使用 **Latest Stable** 版本：

- Next.js 15+
- Drizzle ORM (latest)
- NextAuth.js v5 (Beta) 或 v4
- TanStack Query (latest)
- Zustand (latest)
- MUI v5

### 验证命令

```bash
# 验证构建
npm run build

# 验证类型检查
npm run type-check

# 验证 lint
npm run lint

# 验证格式化
npm run format:check
```

### Project Structure Notes

- 遵循 architecture.md 中定义的项目结构
- 功能模块按 `src/features/` 组织
- 共享组件按 `src/components/` 组织
- 库和工具按 `src/lib/` 组织

### References

- 初始化命令: [architecture.md#implementation-handoff](_bmad-output/planning-artifacts/architecture.md#implementation-handoff)
- 项目结构: [architecture.md#project-structure](_bmad-output/planning-artifacts/architecture.md#project-structure)
- 命名规范: [architecture.md#naming-patterns](_bmad-output/planning-artifacts/architecture.md#naming-patterns)
- API 格式: [architecture.md#format-patterns](_bmad-output/planning-artifacts/architecture.md#format-patterns)

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

### Completion Notes List

- 初始化 Next.js（App Router/TS/Tailwind/src-dir/alias）并迁移到仓库根目录
- 安装核心依赖：Drizzle、NextAuth、TanStack Query、Zustand、React Hook Form、Zod、MUI、AWS SDK
- 配置 Prettier + ESLint(Prettier) + Husky/lint-staged，创建基础目录结构与占位符
- 验证通过：`npm run build`、`npm run dev`（启动后停止）、`npm run lint`
- 说明：本故事为脚手架/配置，未新增业务逻辑测试

### File List

- `.gitignore`
- `.husky/pre-commit`
- `.husky/_/`
- `.prettierrc`
- `README.md`
- `eslint.config.mjs`
- `next-env.d.ts`
- `next.config.ts`
- `package.json`
- `package-lock.json`
- `postcss.config.mjs`
- `public/`
- `src/app/globals.css`
- `src/app/layout.tsx`
- `src/app/page.tsx`
- `src/components/ui/.gitkeep`
- `src/components/shared/.gitkeep`
- `src/features/.gitkeep`
- `src/lib/.gitkeep`
- `src/stores/.gitkeep`
- `src/types/.gitkeep`
- `src/hooks/.gitkeep`

### Change Log

- 2026-02-03: 初始化 Next.js 项目，安装核心依赖，配置代码规范与 Git hooks，完成构建/启动/lint 验证
