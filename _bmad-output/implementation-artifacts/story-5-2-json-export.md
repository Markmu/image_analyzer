# Story 5.2: json-export

Status: done

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

As a ä¸“ä¸šåˆ›ä½œè€…
I want å°†ç”Ÿæˆçš„æ¨¡ç‰ˆå¯¼å‡ºä¸º JSON æ ¼å¼æ–‡ä»¶
so that æˆ‘å¯ä»¥åœ¨å…¶ä»–å·¥å…·å’Œå·¥ä½œæµä¸­é›†æˆä½¿ç”¨è¿™äº›æ¨¡ç‰ˆ

## Acceptance Criteria

1. **AC1:** ç³»ç»Ÿæä¾›"å¯¼å‡º JSON"æŒ‰é’®ï¼Œå¯ä»¥å°†å½“å‰æ¨¡ç‰ˆå¯¼å‡ºä¸º JSON æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°

2. **AC2:** å¯¼å‡ºçš„ JSON æ–‡ä»¶åŒ…å«å®Œæ•´çš„æ¨¡ç‰ˆç»“æ„ï¼š
   - å…ƒæ•°æ®ï¼ˆæ¨¡ç‰ˆ IDã€åˆ›å»ºæ—¶é—´ã€å…³è”çš„åˆ†æç»“æœ IDï¼‰
   - å˜é‡æ¨¡ç‰ˆæ ¼å¼
   - ç»“æ„åŒ– JSON æ ¼å¼ï¼ˆsubject, style, composition, colors, lighting, additionalï¼‰
   - ç”¨æˆ·ç¼–è¾‘åçš„å†…å®¹ï¼ˆå¦‚æœç”¨æˆ·è¿›è¡Œäº†ç¼–è¾‘ï¼‰

3. **AC3:** å¯¼å‡ºçš„ JSON æ–‡ä»¶å‘½åéµå¾ªè§„èŒƒï¼š
   - æ ¼å¼ï¼š`template-{YYYY-MM-DD}-{timestamp}.json`
   - ç¤ºä¾‹ï¼š`template-2026-02-20-164512.json`

4. **AC4:** å¯¼å‡ºæŒ‰é’®é›†æˆåˆ°æ¨¡ç‰ˆç¼–è¾‘å™¨ä¸­ï¼Œä¸å¤åˆ¶æŒ‰é’®å¹¶æ’æ˜¾ç¤º
   - ä½¿ç”¨ Lucide Download å›¾æ ‡ï¼ˆ16pxï¼Œgreen-500ï¼‰
   - ä¸å¤åˆ¶æŒ‰é’®ä¿æŒä¸€è‡´çš„è§†è§‰é£æ ¼

5. **AC5:** å¯¼å‡ºåŠŸèƒ½æ”¯æŒæµè§ˆå™¨åŸç”Ÿä¸‹è½½ API
   - ä¸éœ€è¦æœåŠ¡å™¨ç«¯å¤„ç†
   - æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ˆChrome, Safari, Firefoxï¼‰
   - ç§»åŠ¨ç«¯ä¹Ÿæ”¯æŒå¯¼å‡ºï¼ˆiOS/Androidï¼‰

6. **AC6:** å¯¼å‡ºå‰è¿›è¡Œå†…å®¹å®‰å…¨æ£€æŸ¥ï¼ˆå¤ç”¨ Story 4.1 çš„é€»è¾‘ï¼‰
   - æ£€æµ‹ä¸å½“å†…å®¹
   - å¦‚æœå‘ç°ä¸å½“å†…å®¹ï¼Œæ˜¾ç¤ºè­¦å‘Šå¹¶é˜»æ­¢å¯¼å‡º

7. **AC7:** å¯¼å‡ºæˆåŠŸåæ˜¾ç¤ºå‹å¥½åé¦ˆ
   - Toast æç¤ºï¼š"æ¨¡ç‰ˆå·²å¯¼å‡ºåˆ°ä¸‹è½½æ–‡ä»¶å¤¹"
   - åŒ…å«æ–‡ä»¶åä¿¡æ¯
   - 3 ç§’åè‡ªåŠ¨æ¶ˆå¤±

8. **AC8:** JSON æ–‡ä»¶æ ¼å¼è§„èŒƒï¼Œæ˜“äºå…¶ä»–å·¥å…·è§£æ
   - ä½¿ç”¨æ ‡å‡† JSON æ ¼å¼
   - åŒ…å«æ¸…æ™°çš„å­—æ®µè¯´æ˜ï¼ˆé€šè¿‡æ³¨é‡Šæˆ– READMEï¼‰
   - æ”¯æŒä¸­æ–‡å­—ç¬¦ï¼ˆUTF-8 ç¼–ç ï¼‰

## Tasks / Subtasks

- [ ] **Task 1: åˆ›å»º JSON å¯¼å‡ºç±»å‹å®šä¹‰** (AC: 2, 8)
  - [ ] 1.1 å®šä¹‰ `TemplateExport` æ¥å£ï¼ˆåŒ…å«å…ƒæ•°æ®å’Œæ¨¡ç‰ˆå†…å®¹ï¼‰
  - [ ] 1.2 å®šä¹‰ JSON æ–‡ä»¶å‘½åè§„èŒƒç±»å‹
  - [ ] 1.3 åˆ›å»ºå¯¼å‡ºæ•°æ®éªŒè¯é€»è¾‘

- [ ] **Task 2: å®ç° JSON å¯¼å‡ºé€»è¾‘** (AC: 2, 3, 5, 8)
  - [ ] 2.1 åˆ›å»º `useExportTemplate` hook
  - [ ] 2.2 å®ç°æµè§ˆå™¨åŸç”Ÿä¸‹è½½ API è°ƒç”¨
  - [ ] 2.3 ç”Ÿæˆç¬¦åˆè§„èŒƒçš„æ–‡ä»¶åï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
  - [ ] 2.4 åºåˆ—åŒ–æ¨¡ç‰ˆæ•°æ®ä¸º JSONï¼ˆåŒ…å«å…ƒæ•°æ®ï¼‰
  - [ ] 2.5 ç¡®ä¿ UTF-8 ç¼–ç æ­£ç¡®ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰

- [ ] **Task 3: åˆ›å»ºå¯¼å‡ºæŒ‰é’®ç»„ä»¶** (AC: 4)
  - [ ] 3.1 åˆ›å»º `ExportButton` ç»„ä»¶
  - [ ] 3.2 é›†æˆ Lucide Download å›¾æ ‡ï¼ˆ16pxï¼Œgreen-500ï¼‰
  - [ ] 3.3 åº”ç”¨ Glassmorphism æ ·å¼ï¼ˆä¸å¤åˆ¶æŒ‰é’®ä¸€è‡´ï¼‰
  - [ ] 3.4 å®ç°æ‚¬åœå’Œç‚¹å‡»çŠ¶æ€

- [ ] **Task 4: é›†æˆå†…å®¹å®‰å…¨æ£€æŸ¥** (AC: 6)
  - [ ] 4.1 è°ƒç”¨ Story 4.1 çš„å†…å®¹è¿‡æ»¤é€»è¾‘
  - [ ] 4.2 åœ¨å¯¼å‡ºå‰æ£€æŸ¥æ¨¡ç‰ˆå†…å®¹
  - [ ] 4.3 å¦‚æœå‘ç°ä¸å½“å†…å®¹ï¼Œæ˜¾ç¤ºè­¦å‘Šå¯¹è¯æ¡†
  - [ ] 4.4 é˜»æ­¢ä¸å½“å†…å®¹çš„å¯¼å‡º

- [ ] **Task 5: å®ç°å¯¼å‡ºåé¦ˆæœºåˆ¶** (AC: 7)
  - [ ] 5.1 åˆ›å»º Toast æç¤ºç»„ä»¶ï¼ˆå¤ç”¨ç°æœ‰ Toast ç³»ç»Ÿï¼‰
  - [ ] 5.2 æ˜¾ç¤ºå¯¼å‡ºæˆåŠŸæ¶ˆæ¯ï¼ˆåŒ…å«æ–‡ä»¶åï¼‰
  - [ ] 5.3 å®ç° 3 ç§’åè‡ªåŠ¨æ¶ˆå¤±
  - [ ] 5.4 å¤„ç†å¯¼å‡ºå¤±è´¥æƒ…å†µï¼ˆæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼‰

- [ ] **Task 6: é›†æˆåˆ°æ¨¡ç‰ˆç¼–è¾‘å™¨** (AC: 4)
  - [ ] 6.1 ä¿®æ”¹ `TemplateEditor` ç»„ä»¶ï¼Œæ·»åŠ å¯¼å‡ºæŒ‰é’®
  - [ ] 6.2 ç¡®ä¿å¯¼å‡ºæŒ‰é’®ä¸å¤åˆ¶æŒ‰é’®å¹¶æ’æ˜¾ç¤º
  - [ ] 6.3 å®ç°æŒ‰é’®é—´çš„ä¸€è‡´é—´è·
  - [ ] 6.4 æµ‹è¯•æŒ‰é’®åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤º

- [ ] **Task 7: æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•** (AC: 5)
  - [ ] 7.1 Chrome å¯¼å‡ºåŠŸèƒ½æµ‹è¯•
  - [ ] 7.2 Safari å¯¼å‡ºåŠŸèƒ½æµ‹è¯•
  - [ ] 7.3 Firefox å¯¼å‡ºåŠŸèƒ½æµ‹è¯•
  - [ ] 7.4 ç§»åŠ¨ç«¯æµè§ˆå™¨æµ‹è¯•ï¼ˆiOS Safari, Android Chromeï¼‰

- [ ] **Task 8: å•å…ƒæµ‹è¯•**
  - [ ] 8.1 æµ‹è¯• `useExportTemplate` hook
  - [ ] 8.2 æµ‹è¯• JSON åºåˆ—åŒ–é€»è¾‘
  - [ ] 8.3 æµ‹è¯•æ–‡ä»¶åç”Ÿæˆé€»è¾‘
  - [ ] 8.4 æµ‹è¯•å†…å®¹å®‰å…¨æ£€æŸ¥é›†æˆ

- [ ] **Task 9: é›†æˆæµ‹è¯•**
  - [ ] 9.1 æµ‹è¯•å¯¼å‡ºæŒ‰é’®ç»„ä»¶æ¸²æŸ“
  - [ ] 9.2 æµ‹è¯•å¯¼å‡ºæµç¨‹ï¼ˆç‚¹å‡» â†’ ä¸‹è½½ â†’ åé¦ˆï¼‰
  - [ ] 9.3 æµ‹è¯•å†…å®¹å®‰å…¨æ£€æŸ¥æµç¨‹
  - [ ] 9.4 æµ‹è¯•é”™è¯¯å¤„ç†ï¼ˆç½‘ç»œé”™è¯¯ã€æƒé™é”™è¯¯ï¼‰

- [ ] **Task 10: E2E æµ‹è¯•**
  - [ ] 10.1 æµ‹è¯•å®Œæ•´å¯¼å‡ºæµç¨‹ï¼ˆåˆ†æ â†’ ç”Ÿæˆæ¨¡ç‰ˆ â†’ å¯¼å‡º JSONï¼‰
  - [ ] 10.2 éªŒè¯å¯¼å‡ºçš„ JSON æ–‡ä»¶æ ¼å¼æ­£ç¡®
  - [ ] 10.3 æµ‹è¯•ç§»åŠ¨ç«¯å¯¼å‡ºæµç¨‹
  - [ ] 10.4 æµ‹è¯•ä¸åŒæµè§ˆå™¨çš„å¯¼å‡ºåŠŸèƒ½

## Dev Notes

### ä¸šåŠ¡ä¸Šä¸‹æ–‡

**Epic 5 ç›®æ ‡ï¼š** æ¨¡ç‰ˆç”Ÿæˆä¸ç®¡ç† - ç”¨æˆ·å¯ä»¥è·å¾—ç»“æ„åŒ–çš„æç¤ºè¯æ¨¡ç‰ˆï¼Œæ”¯æŒç¼–è¾‘å’Œå¯¼å‡º

**Story 5.2 å®šä½ï¼š** åœ¨ Story 5.1ï¼ˆæ¨¡ç‰ˆç”Ÿæˆï¼‰çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ  JSON æ ¼å¼å¯¼å‡ºåŠŸèƒ½ï¼Œæ»¡è¶³ä¸“ä¸šç”¨æˆ·é›†æˆå·¥ä½œæµçš„éœ€æ±‚

**ç”¨æˆ·ä»·å€¼ï¼š**
- ä¸“ä¸šç”¨æˆ·ï¼šå°†æ¨¡ç‰ˆé›†æˆåˆ°è‡ªåŠ¨åŒ–å·¥ä½œæµï¼ˆå¦‚ ComfyUIã€Stable Diffusion WebUIï¼‰
- å¼€å‘è€…ï¼šé€šè¿‡ JSON æ ¼å¼æ‰¹é‡å¤„ç†æ¨¡ç‰ˆ
- é«˜çº§ç”¨æˆ·ï¼šåœ¨ä¸åŒå·¥å…·é—´å…±äº«æ¨¡ç‰ˆ
- æ‰€æœ‰äººï¼šæ‹¥æœ‰æ¨¡ç‰ˆçš„å®Œæ•´æ‰€æœ‰æƒï¼ˆå¯ç¦»çº¿ä½¿ç”¨ï¼‰

**ä¸ºä»€ä¹ˆè¿™ä¸ªåŠŸèƒ½é‡è¦ï¼ˆDeal-Breakerï¼‰ï¼š**
- ä¸“ä¸šç”¨æˆ·éœ€è¦å°†æ¨¡ç‰ˆå¯¼å‡ºåˆ°å…¶ä»– AI ç»˜ç”»å·¥å…·
- JSON æ ¼å¼æ˜¯è¡Œä¸šæ ‡å‡†ï¼Œæ˜“äºè§£æå’Œé›†æˆ
- ç¦»çº¿ä½¿ç”¨ï¼šç”¨æˆ·å¯ä»¥åœ¨æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µä¸‹ä½¿ç”¨å¯¼å‡ºçš„æ¨¡ç‰ˆ

### ç›¸å…³åŠŸèƒ½éœ€æ±‚ï¼ˆFRï¼‰

- **FR20:** ç³»ç»Ÿå¯ä»¥ç”Ÿæˆ JSON æ ¼å¼çš„æ¨¡ç‰ˆä¾›ä¸“ä¸šç”¨æˆ·é›†æˆå·¥ä½œæµ
- **FR24:** ç”¨æˆ·å¯ä»¥å¯¼å‡º JSON æ ¼å¼çš„æ¨¡ç‰ˆæ–‡ä»¶

### æ¶æ„çº¦æŸ

**æŠ€æœ¯æ ˆï¼š**
- å‰ç«¯æ¡†æ¶ï¼šNext.js 15+ (App Router)
- çŠ¶æ€ç®¡ç†ï¼šZustandï¼ˆUI çŠ¶æ€ï¼‰+ React Queryï¼ˆæœåŠ¡å™¨çŠ¶æ€ï¼‰
- UI ç»„ä»¶ï¼šMUI + Tailwind CSSï¼ˆGlassmorphism æ ·å¼ï¼‰
- å›¾æ ‡åº“ï¼šLucide Reactï¼ˆå¿…é¡»ä½¿ç”¨ Download å›¾æ ‡ï¼‰
- ç±»å‹æ£€æŸ¥ï¼šTypeScript

**å‘½åè§„èŒƒï¼š**
- ç»„ä»¶ï¼šPascalCaseï¼ˆ`ExportButton`, `TemplateEditor`ï¼‰
- å‡½æ•°/å˜é‡ï¼šcamelCaseï¼ˆ`exportTemplate`, `generateFileName`ï¼‰
- ç±»å‹/æ¥å£ï¼šPascalCaseï¼ˆ`TemplateExport`, `ExportOptions`ï¼‰
- å¸¸é‡ï¼šUPPER_SNAKE_CASEï¼ˆ`EXPORT_MIME_TYPE`ï¼‰
- æ–‡ä»¶åï¼škebab-caseï¼ˆ`export-button.tsx`ï¼‰

**é¡¹ç›®ç»“æ„ï¼š**
```
src/features/templates/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ExportButton/
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ ExportButton.tsx
â”‚   â”‚   â”œâ”€â”€ ExportButton.test.tsx
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ TemplateEditor/
â”‚       â”œâ”€â”€ index.tsx
â”‚       â”œâ”€â”€ TemplateEditor.tsx  # ä¿®æ”¹ï¼šæ·»åŠ å¯¼å‡ºæŒ‰é’®
â”‚       â””â”€â”€ TemplateEditor.test.tsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useExportTemplate.ts  # æ–°å¢
â”‚   â””â”€â”€ useCopyToClipboard.ts
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ template-exporter.ts  # æ–°å¢
â”‚   â””â”€â”€ template-generator.ts
â””â”€â”€ types/
    â”œâ”€â”€ template.ts
    â””â”€â”€ export.ts  # æ–°å¢
```

### æ•°æ®ç»“æ„è®¾è®¡

**TemplateExport æ¥å£ï¼š**
```typescript
interface TemplateExport {
  metadata: {
    version: string;  // å¯¼å‡ºæ ¼å¼ç‰ˆæœ¬ï¼ˆå¦‚ "1.0.0"ï¼‰
    templateId: string;
    analysisResultId: string;
    createdAt: string;  // ISO 8601 æ ¼å¼
    exportedAt: string;  // ISO 8601 æ ¼å¼
    platform: string;  // "image_analyzer"
  };
  template: {
    variableFormat: string;
    jsonFormat: {
      subject: string;
      style: string;
      composition: string;
      colors: string;
      lighting: string;
      additional: string;
    };
  };
  usage: {
    description: string;
    examples: string[];
    notes: string[];
  };
}
```

**å¯¼å‡ºæ–‡ä»¶åæ ¼å¼ï¼š**
```typescript
// template-{YYYY-MM-DD}-{timestamp}.json
// ç¤ºä¾‹ï¼štemplate-2026-02-20-164512.json
const generateFileName = (): string => {
  const now = new Date();
  const date = now.toISOString().split('T')[0];  // YYYY-MM-DD
  const time = now.toTimeString().split(' ')[0].replace(/:/g, '');  // HHMMSS
  return `template-${date}-${time}.json`;
};
```

### API è®¾è®¡

**å¯¼å‡ºæ¨¡ç‰ˆï¼ˆæµè§ˆå™¨ APIï¼Œæ— éœ€åç«¯ï¼‰ï¼š**
```typescript
// src/features/templates/hooks/useExportTemplate.ts
export function useExportTemplate() {
  const exportTemplate = (template: Template) => {
    // 1. å†…å®¹å®‰å…¨æ£€æŸ¥
    // 2. åˆ›å»º TemplateExport å¯¹è±¡
    // 3. åºåˆ—åŒ–ä¸º JSON
    // 4. è§¦å‘æµè§ˆå™¨ä¸‹è½½
  };

  return { exportTemplate, isExporting, error };
}
```

**å†…å®¹å®‰å…¨æ£€æŸ¥ï¼ˆè°ƒç”¨ Story 4.1 çš„é€»è¾‘ï¼‰ï¼š**
```typescript
// src/features/templates/lib/template-exporter.ts
import { checkContentSafety } from '@/lib/content-moderation';

export async function validateTemplateForExport(template: Template): Promise<boolean> {
  // æ£€æŸ¥æ‰€æœ‰å­—æ®µæ˜¯å¦åŒ…å«ä¸å½“å†…å®¹
  const combinedText = Object.values(template.jsonFormat).join(' ');
  const isSafe = await checkContentSafety(combinedText);
  return isSafe;
}
```

### UI/UX è®¾è®¡è§„èŒƒ

**Glassmorphism æ ·å¼ï¼š**
- å¯¼å‡ºæŒ‰é’®ä½¿ç”¨ `ia-glass-card` ç±»
- æ‚¬åœçŠ¶æ€ï¼š`ia-glass-card:hover`
- ä¸å¤åˆ¶æŒ‰é’®ä¿æŒä¸€è‡´çš„è§†è§‰é£æ ¼

**å›¾æ ‡ç³»ç»Ÿï¼š**
- ä¸‹è½½å›¾æ ‡ï¼š`<Download size={16} className="text-green-500" />`
- å¿…é¡»ä½¿ç”¨ Lucide å›¾æ ‡åº“
- å°ºå¯¸ï¼š16pxï¼ˆä¸å¤åˆ¶æŒ‰é’®ä¸€è‡´ï¼‰
- é¢œè‰²ï¼š`text-green-500`ï¼ˆä¸»è¦æ“ä½œï¼‰

**æŒ‰é’®å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡ç‰ˆç¼–è¾‘å™¨                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [ç¼–è¾‘åŒºåŸŸ]                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ [å¤åˆ¶]   â”‚  â”‚ [å¯¼å‡º]   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Toast åé¦ˆï¼š**
- æˆåŠŸæç¤ºï¼šç»¿è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—
- åŒ…å«æ–‡ä»¶åä¿¡æ¯
- 3 ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼ˆä½¿ç”¨ MUI Snackbarï¼‰

### æ€§èƒ½è¦æ±‚

- å¯¼å‡ºå‡†å¤‡æ—¶é—´ï¼š< 50msï¼ˆæœ¬åœ°å¤„ç†ï¼‰
- æ–‡ä»¶ç”Ÿæˆæ—¶é—´ï¼š< 100ms
- ä¸‹è½½å¯åŠ¨æ—¶é—´ï¼š< 200msï¼ˆç”¨æˆ·æ„ŸçŸ¥ï¼‰

### å®‰å…¨è€ƒè™‘

- **å†…å®¹å®‰å…¨ï¼š** å¯¼å‡ºå‰æ£€æŸ¥ä¸å½“å†…å®¹ï¼ˆå¤ç”¨ Story 4.1 é€»è¾‘ï¼‰
- **ç”¨æˆ·æƒé™ï¼š** åªèƒ½å¯¼å‡ºè‡ªå·±çš„æ¨¡ç‰ˆ
- **æ•°æ®éšç§ï¼š** å¯¼å‡ºæ“ä½œä¸ç»è¿‡æœåŠ¡å™¨ï¼Œå®Œå…¨åœ¨å®¢æˆ·ç«¯è¿›è¡Œ
- **XSS é˜²æŠ¤ï¼š** JSON æ–‡ä»¶ä½¿ç”¨æ ‡å‡†åºåˆ—åŒ–ï¼Œé¿å…æ³¨å…¥æ”»å‡»

### æµè§ˆå™¨å…¼å®¹æ€§

**æ”¯æŒçš„æµè§ˆå™¨ï¼š**
- Chrome 90+ï¼ˆå®Œå…¨æ”¯æŒï¼‰
- Safari 14+ï¼ˆå®Œå…¨æ”¯æŒï¼‰
- Firefox 88+ï¼ˆå®Œå…¨æ”¯æŒï¼‰
- Edge 90+ï¼ˆå®Œå…¨æ”¯æŒï¼‰

**ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼š**
- iOS Safari 14+ï¼ˆæ”¯æŒï¼Œä½†ä¸‹è½½è¡Œä¸ºå¯èƒ½ä¸åŒï¼‰
- Android Chrome 90+ï¼ˆå®Œå…¨æ”¯æŒï¼‰

**é™çº§æ–¹æ¡ˆï¼š**
- å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ Blob APIï¼Œæ˜¾ç¤ºå‹å¥½æç¤ºï¼š"æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ­¤åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chrome/Safari/Firefox"

### ä¾èµ–å…³ç³»

**å‰ç½®ä¾èµ–ï¼š**
- âœ… Story 5.1: æ¨¡ç‰ˆç”Ÿæˆï¼ˆå·²å®Œæˆ `Template` æ¥å£å’Œ `jsonFormat`ï¼‰
- âœ… Story 4.1: å†…å®¹å®¡æ ¸ï¼ˆå·²å®Œæˆå†…å®¹å®‰å…¨æ£€æŸ¥é€»è¾‘ï¼‰
- âœ… UX-UPGRADE-1: UX è®¾è®¡è§„èŒƒå‡çº§ï¼ˆGlassmorphism + Lucide å›¾æ ‡ï¼‰

**åç½®ä¾èµ–ï¼š**
- ğŸŸ¡ Story 5.3: æ¨¡ç‰ˆç¼–è¾‘å™¨ï¼ˆå¯å¯¼å‡ºç¼–è¾‘åçš„æ¨¡ç‰ˆï¼‰
- ğŸŸ¡ Story 5.4: æç¤ºè¯ä¼˜åŒ–ï¼ˆå¯å¯¼å‡ºä¼˜åŒ–åçš„æ¨¡ç‰ˆï¼‰

### JSON æ–‡ä»¶æ ¼å¼ç¤ºä¾‹

```json
{
  "metadata": {
    "version": "1.0.0",
    "templateId": "tpl_1234567890",
    "analysisResultId": "ar_0987654321",
    "createdAt": "2026-02-20T16:45:12.000Z",
    "exportedAt": "2026-02-20T16:45:12.000Z",
    "platform": "image_analyzer"
  },
  "template": {
    "variableFormat": "A [subject] in [style] style, with [composition] composition, [colors] color palette, and [lighting] lighting",
    "jsonFormat": {
      "subject": "a beautiful woman",
      "style": "portrait photography",
      "composition": "close-up, centered",
      "colors": "warm tones, soft brown and gold",
      "lighting": "soft natural light, golden hour",
      "additional": "elegant pose, serene expression"
    }
  },
  "usage": {
    "description": "AI å›¾åƒç”Ÿæˆæç¤ºè¯æ¨¡ç‰ˆï¼Œå¯ç”¨äº Stable Diffusionã€Midjourneyã€DALL-E ç­‰å·¥å…·",
    "examples": [
      "Stable Diffusion: ç›´æ¥å¤åˆ¶ variableFormat åˆ°æç¤ºè¯æ¡†",
      "ComfyUI: ä½¿ç”¨ jsonFormat å­—æ®µæ„å»ºå·¥ä½œæµ",
      "API è°ƒç”¨: POST /generate with jsonFormat body"
    ],
    "notes": [
      "æ›¿æ¢ [å˜é‡å] ä¸ºä½ æƒ³è¦çš„æè¿°",
      "ä¿ç•™åŸæœ‰çš„é£æ ¼å…³é”®è¯",
      "å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ additional å­—æ®µ"
    ]
  }
}
```

### é£é™©å’Œç¼“è§£æªæ–½

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|-------|------|---------|
| æµè§ˆå™¨ä¸æ”¯æŒ Blob API | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | æä¾›é™çº§æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·ä½¿ç”¨ç°ä»£æµè§ˆå™¨ |
| ç§»åŠ¨ç«¯ä¸‹è½½ä½“éªŒå·® | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | æµ‹è¯• iOS/Androidï¼Œæä¾›æ¸…æ™°çš„ä¸‹è½½æŒ‡å¼• |
| JSON æ ¼å¼è§£æé”™è¯¯ | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ä½¿ç”¨æ ‡å‡† JSON.stringifyï¼Œæ·»åŠ æ ¼å¼éªŒè¯ |
| å†…å®¹å®‰å…¨æ£€æŸ¥é—æ¼ | ğŸŸ¢ ä½ | ğŸ”´ é«˜ | å¤ç”¨ Story 4.1 çš„æˆç†Ÿé€»è¾‘ï¼Œå®šæœŸæ›´æ–°å…³é”®è¯åº“ |
| å¯¼å‡ºçš„æ–‡ä»¶åå†²çª | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§ |

### éªŒæ”¶æµ‹è¯•æ£€æŸ¥æ¸…å•

**åŠŸèƒ½æµ‹è¯•ï¼š**
- [ ] å¯¼å‡ºæŒ‰é’®æ˜¾ç¤ºæ­£ç¡®ï¼ˆDownload å›¾æ ‡ï¼Œgreen-500ï¼‰
- [ ] ç‚¹å‡»å¯¼å‡ºæŒ‰é’®è§¦å‘ä¸‹è½½
- [ ] å¯¼å‡ºçš„ JSON æ–‡ä»¶æ ¼å¼æ­£ç¡®
- [ ] JSON æ–‡ä»¶åŒ…å«å®Œæ•´çš„å…ƒæ•°æ®
- [ ] JSON æ–‡ä»¶åéµå¾ªå‘½åè§„èŒƒ
- [ ] å†…å®¹å®‰å…¨æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- [ ] å¯¼å‡ºæˆåŠŸåæ˜¾ç¤º Toast æç¤º
- [ ] Toast æç¤ºåŒ…å«æ–‡ä»¶åä¿¡æ¯

**è§†è§‰æµ‹è¯•ï¼š**
- [ ] å¯¼å‡ºæŒ‰é’® Glassmorphism æ ·å¼æ­£ç¡®
- [ ] Download å›¾æ ‡æ˜¾ç¤ºæ­£ç¡®
- [ ] å¯¼å‡ºæŒ‰é’®ä¸å¤åˆ¶æŒ‰é’®å¹¶æ’æ˜¾ç¤º
- [ ] æŒ‰é’®é—´è·å’Œå¸ƒå±€æ­£ç¡®
- [ ] Toast æç¤ºæ ·å¼æ­£ç¡®

**å…¼å®¹æ€§æµ‹è¯•ï¼š**
- [ ] Chrome å¯¼å‡ºåŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] Safari å¯¼å‡ºåŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] Firefox å¯¼å‡ºåŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ç§»åŠ¨ç«¯å¯¼å‡ºåŠŸèƒ½æµ‹è¯•é€šè¿‡

**æ€§èƒ½æµ‹è¯•ï¼š**
- [ ] å¯¼å‡ºå‡†å¤‡æ—¶é—´ < 50ms
- [ ] æ–‡ä»¶ç”Ÿæˆæ—¶é—´ < 100ms
- [ ] ä¸‹è½½å¯åŠ¨æ—¶é—´ < 200ms

**å®‰å…¨æµ‹è¯•ï¼š**
- [ ] å†…å®¹å®‰å…¨æ£€æŸ¥æ­£ç¡®æ‹¦æˆªä¸å½“å†…å®¹
- [ ] ç”¨æˆ·æ— æ³•å¯¼å‡ºä»–äººçš„æ¨¡ç‰ˆ
- [ ] JSON æ–‡ä»¶ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· IDï¼‰
- [ ] å¯¼å‡ºæ“ä½œä¸ç»è¿‡æœåŠ¡å™¨ï¼ˆå®Œå…¨å®¢æˆ·ç«¯ï¼‰

**ç”¨æˆ·ä½“éªŒæµ‹è¯•ï¼š**
- [ ] å¯¼å‡ºæµç¨‹æµç•…ï¼ˆç‚¹å‡» â†’ ä¸‹è½½ â†’ åé¦ˆï¼‰
- [ ] é”™è¯¯æƒ…å†µæœ‰å‹å¥½æç¤º
- [ ] ç§»åŠ¨ç«¯ä½“éªŒè‰¯å¥½
- [ ] æ–‡ä»¶å¯ä»¥åœ¨å…¶ä»–å·¥å…·ä¸­æ­£å¸¸è§£æ

### Previous Story Intelligence

ä» Story 5.1ï¼ˆæ¨¡ç‰ˆç”Ÿæˆï¼‰å­¦åˆ°çš„ç»éªŒï¼š

1. **æ¨¡ç‰ˆæ•°æ®ç»“æ„ï¼š** Story 5.1 å·²ç»å®šä¹‰äº† `Template` æ¥å£ï¼ŒåŒ…å« `jsonFormat` å­—æ®µï¼Œå¯ä»¥ç›´æ¥ç”¨äºå¯¼å‡º
2. **å†…å®¹å®‰å…¨æ£€æŸ¥ï¼š** Story 4.1 çš„å†…å®¹å®¡æ ¸é€»è¾‘å·²ç»æˆç†Ÿï¼Œå¯ä»¥ç›´æ¥å¤ç”¨
3. **UI ç»„ä»¶æ¨¡å¼ï¼š** å‚è€ƒ `CopyButton` ç»„ä»¶çš„å®ç°ï¼Œä¿æŒä¸€è‡´çš„ä»£ç é£æ ¼
4. **æµ‹è¯•ç­–ç•¥ï¼š** Story 5.1 çš„æµ‹è¯•è¦†ç›–äº†æ¨¡ç‰ˆç”Ÿæˆé€»è¾‘ï¼Œ5.2 åº”è¯¥é‡ç‚¹å…³æ³¨å¯¼å‡ºé€»è¾‘

**éœ€è¦æ³¨æ„çš„å˜æ›´ï¼š**
- å¯¼å‡ºåŠŸèƒ½ä¸éœ€è¦æœåŠ¡å™¨ç«¯ APIï¼Œå®Œå…¨åœ¨å®¢æˆ·ç«¯å¤„ç†
- éœ€è¦å¤„ç†æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼ˆç‰¹åˆ«æ˜¯ç§»åŠ¨ç«¯ï¼‰
- éœ€è¦æä¾›å‹å¥½çš„é”™è¯¯æç¤ºï¼ˆå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒï¼‰

### Git Intelligence

æœ€è¿‘çš„æäº¤è®°å½•æ˜¾ç¤ºï¼š
- `ace3833`: ä¿®å¤äº† Aliyun å›¾ç‰‡ä¸Šä¼ çš„ base64 ç¼–ç é—®é¢˜
- `94c1ab0`: ä¸º Paper ç»„ä»¶åº”ç”¨äº† Glassmorphism èƒŒæ™¯
- `dbeeb63`: é»˜è®¤å±•å¼€åˆ†æè¯¦æƒ…å’Œè´¨é‡ä¿¡æ¯

**ç›¸å…³ä»£ç æ¨¡å¼ï¼š**
- Glassmorphism æ ·å¼å·²ç»åœ¨é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨
- Lucide å›¾æ ‡ç³»ç»Ÿå·²ç»å»ºç«‹ï¼ˆå‚è€ƒ `Copy` å›¾æ ‡çš„ä½¿ç”¨ï¼‰
- Toast åé¦ˆæœºåˆ¶å·²ç»å­˜åœ¨ï¼ˆå¤ç”¨ç°æœ‰å®ç°ï¼‰

### Latest Tech Information

**æµè§ˆå™¨ä¸‹è½½ APIï¼š**
- ä½¿ç”¨ `URL.createObjectURL()` å’Œ `<a>` æ ‡ç­¾çš„ `download` å±æ€§
- æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ˆChrome 90+, Safari 14+, Firefox 88+ï¼‰
- ç§»åŠ¨ç«¯æ”¯æŒï¼šiOS Safari 14+, Android Chrome 90+

**JSON åºåˆ—åŒ–ï¼š**
- ä½¿ç”¨ `JSON.stringify(data, null, 2)` æ ¼å¼åŒ–è¾“å‡º
- ç¡®ä¿ä¸­æ–‡å­—ç¬¦æ­£ç¡®ç¼–ç ï¼ˆUTF-8ï¼‰
- æ·»åŠ  BOMï¼ˆByte Order Markï¼‰ä»¥æé«˜å…¼å®¹æ€§

**æ–‡ä»¶åæœ€ä½³å®è·µï¼š**
- ä½¿ç”¨ ISO 8601 æ—¥æœŸæ ¼å¼ï¼ˆYYYY-MM-DDï¼‰
- ä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§
- é¿å…ç‰¹æ®Šå­—ç¬¦ï¼ˆåªä½¿ç”¨å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦ï¼‰

### Project Context Reference

**é¡¹ç›®ä½ç½®ï¼š** `/Users/muchao/code/image_analyzer`

**ç›¸å…³æ–‡æ¡£ï¼š**
- PRD: `/Users/muchao/code/image_analyzer/_bmad-output/planning-artifacts/prd.md`
- Architecture: `/Users/muchao/code/image_analyzer/_bmad-output/planning-artifacts/architecture.md`
- UX Design: `/Users/muchao/code/image_analyzer/_bmad-output/planning-artifacts/ux-design-specification.md`
- Story 5.1: `/Users/muchao/code/image_analyzer/_bmad-output/implementation-artifacts/story-5-1-template-generation.md`

**å…³é”®ä¾èµ–ï¼š**
- Story 4.1: å†…å®¹å®¡æ ¸é€»è¾‘ï¼ˆ`src/lib/content-moderation.ts`ï¼‰
- Story 5.1: æ¨¡ç‰ˆç”Ÿæˆé€»è¾‘ï¼ˆ`src/features/templates/lib/template-generator.ts`ï¼‰
- UX-UPGRADE-1: Glassmorphism æ ·å¼ï¼ˆ`src/app/globals.css`ï¼‰

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.6 (claude-sonnet-4-6)

### Debug Log References

### Completion Notes List

### File List
