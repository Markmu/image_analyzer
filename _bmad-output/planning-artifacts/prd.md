---
stepsCompleted: ["step-01-init", "step-02-discovery", "step-03-success", "step-04-journeys", "step-05-domain", "step-06-innovation", "step-07-project-type", "step-08-scoping", "step-09-functional", "step-10-nonfunctional", "step-11-polish"]
inputDocuments:
  - /Users/muchao/code/image_analyzer/_bmad-output/planning-artifacts/product-brief-image_analyzer-2026-01-30.md
documentCounts:
  productBriefs: 1
  researchDocuments: 0
  brainstormingDocuments: 0
  projectDocumentation: 0
workflowType: 'prd'
project_name: 'image_analyzer'
user_name: 'Muchao'
date: '2026-01-31'
status: 'draft'
classification:
  projectType: 'web-app-saas-b2c'
  domain: 'creative-ai-tools'
  complexity: 'medium'
  projectContext: 'greenfield'
---

# Product Requirements Document - image_analyzer

**Author:** Muchao
**Date:** 2026-01-31

## Success Criteria

### User Success

**核心成功时刻**
用户第一次使用生成的模版成功创建了满意的同风格图片，并通过以下行为验证满意度：
- 保存生成的图片到本地设备
- 分享生成的图片到社交媒体或社区

**用户体验目标**
- **3 分钟完成全流程**：从上传参考图片到导出可用的提示词模版（竞品平均需要 30 分钟）
- **"震惊时刻"体验**：用户看到结构化分析结果时的专业度和精确性超出预期

### Business Success

**保守收入目标（第一年）**
- **100 付费用户** × 平均 $12.5/月 = **$15,000 ARR**
- **付费转化率**：5%+（注册用户 → 付费用户）
- **目标市场**：美国、欧洲为主（美元计费）

**中期里程碑检查点**
| 时间节点 | 付费用户目标 | 累计 ARR（月度） |
|---------|-------------|---------------|
| 3 个月 | 10 个付费用户 | $125/月 |
| 6 个月 | 50 个付费用户 | $625/月 |
| 12 个月 | 100 个付费用户 | $1,250/月 |

**用户留存**
- 实际数据驱动，暂不预设固定指标
- 通过用户行为数据（保存、分享、重复使用）持续优化产品

**关键业务指标**
- **获客成本（CAC）**：$5-8 USD/用户
- **客户生命周期价值（LTV）**：$60-90 USD（基于 6-12 个月留存）
- **LTV/CAC 比率**：10:1 到 15:1（健康的 SaaS 标准）

### Technical Success

**分析质量指标**
1. **模版复用率**：用户重复使用同一个模版的次数
   - 高复用率 = 模版质量高，分析准确

2. **模版修改率**：用户在生成前修改模版的比例
   - 低修改率 = 分析准确，用户可直接使用
   - 高修改率 = 需要优化提示词工程

**多模型支持架构**
系统分为三大模型类别，每类都支持可扩展的提供商接入：

| 模型类别 | 功能 | MVP 要求 | 扩展性 |
|---------|------|---------|--------|
| **视觉模型** | 图片理解与风格分析 | 至少 1 个 | ✅ 支持接入更多 |
| **文字模型** | 提示词模版优化 | 至少 1 个 | ✅ 支持接入更多 |
| **生图模型** | 用户生成同风格图片 | 至少 1 个 | ✅ 支持接入更多 |

**用户可控制性**
- 用户可手动选择每类模型使用的提供商
- 系统提供推荐默认值，用户可自定义

**提示词工程演进路径**
- **MVP（0-6 个月）**：简单提示词版本
- **优化（6-18 个月）**：基于用户反馈迭代优化
- **长期（18 个月+）**：评估演变为 multi-agent 流程

### Measurable Outcomes

**产品-市场匹配验证**
- 前 100 用户中，7 天留存率 > 30%
- 30 天内至少 20 个用户重复使用产品

**用户行为指标**
- 图片保存率 > 60%（生成的图片被保存的比例）
- 图片分享率 > 15%（生成的图片被分享的比例）- **网络效应早期信号**
- 模版复用率 > 40%（同一模版被多次使用的比例）

**业务指标**
- 3 个月：10 付费用户
- 6 个月：50 付费用户
- 12 个月：100 付费用户，$15,000 ARR

**SEO 里程碑**（主要获客渠道）
- 3 个月：核心关键词进入 Google 前 3 页
- 6 个月：核心关键词稳定首页，流量 > 10,000/月

**用户推荐度**
- NPS（净推荐值）> 40（产品真正成功的早期信号）

**技术指标**
- 模版修改率 < 30%（用户直接使用模版的比例）
- 分析成功率 > 95%（API 调用成功返回结果的比例）

基于上述成功标准，以下产品范围定义了实现这些目标所需的功能。

## Product Scope

### MVP - Minimum Viable Product (0-6 months)

**核心功能（优先级排序）**

**P0 - 核心必需（决定成败）：**
1. ✅ Google 登录集成
   - 获取用户基本信息（Email、姓名、头像）
   - 新用户自动获赠 3 次 free credit
   - 直接进入产品，无需额外注册步骤
2. ✅ 单张图片上传（核心交互）
3. ✅ 智能风格分析（光影、构图、色彩、艺术流派四大维度）
4. ✅ 结构化模版生成（JSON 格式 + 变量模版格式）
5. ✅ 模版导出 - 复制到剪贴板（必需）
6. ✅ JSON 格式导出（专业用户 Deal-breaker）
7. ✅ 图像生成集成（验证闭环）
8. ✅ 接入视觉模型（至少 1 个提供商）

**P1 - 优化功能（MVP 可简化）：**
9. ⚠️ 批量上传（最多 5 张同风格图片，优先级降低）
10. ⚠️ 历史记录保存（简化版：最近 10 次分析）
11. ⚠️ 用户可手动切换模型提供商（技术灵活性）

**Credit 订阅制（基于使用量的简化版）：**
- **Free 等级**：
  - Google 登录后自动获赠 3 次 free credit
  - 适用于新用户体验产品价值
- **Standard 订阅**：
  - 每月 50 次 credit
  - 定价：$9.99/月 或 $99/年（约 $8.25/月）
  - 适用于重度用户

**不包含**
- ❌ 模版市场
- ❌ 社区分享功能
- ❌ 高级参数控制（由系统全自动分析）
- ❌ API 访问
- ❌ 团队协作功能

### Growth Features (Post-MVP)

**Credit 系统扩展**
- ✅ Credit 包购买（Standard 订阅用户用完 credit 后可购买额外 credit 包）
  - 小包：10 次 credit - $4.99
  - 中包：25 次 credit - $9.99
  - 大包：50 次 credit - $14.99

**用户体验优化**
- ✅ 分析维度选择（用户可手动开启/关闭特定维度）
- ✅ 详细程度控制（简略/标准/详细三档输出）
- ✅ 历史记录保存（扩展到 90 天）
- ✅ Pro 订阅等级（$25-30/月，包含更多 credit 和优先处理）

**内容与社区**
- ✅ UGC 营销机制（用户授权公开成功案例，获得积分奖励）
- ✅ Show Case 画廊（展示优秀案例）

**技术优化**
- ✅ 扩展更多模型提供商接入
- ✅ 提示词工程优化（基于用户反馈）
- ✅ 分析质量一致性和准确性提升

### Vision (Future)

**平台生态**
- 🎨 **模版市场**：用户可分享、收藏、交易风格模版
- 🏢 **专业市场进入**：面向设计工作室、广告公司的 B2B 版本
- 🔄 **网络效应**：模版越多 → 用户越多 → 模版更多...

**高级功能**
- 🛠️ API 访问（供开发者集成）
- 🛠️ 批量处理（高级功能）
- 🛠️ 品牌风格预设（企业级功能）
- 🛠️ 团队协作功能（Team 订阅，Enterprise 定制定价）
- 🎯 Multi-agent 提示词工程流程（可选的升级版分析模式）

**技术护城河**
- 🚀 训练专用风格识别模型
- 🎯 支持分析参数控制（满足进阶用户需求）

以下用户旅程深入探讨了产品的核心价值主张和用户体验。

## 用户旅程

### 旅程 1：新手创作者 - Alex（成功路径）

**人物画像**
- **姓名**：Alex
- **年龄**：24 岁
- **职业**：市场营销专员，业余 AI 绘画创作者
- **技能水平**：完全新手 - 不懂摄影或艺术理论
- **痛点**：在 Instagram 上看到很酷的风格图片，但不知道如何专业地描述它们

**开篇场景 - 问题所在**

一个周五晚上，Alex 刷着 Instagram，被一张霓虹灯光和未来氛围的赛博朋克风格图片深深吸引。他想："要是能用这种风格生成我的 D&D 角色该多酷啊！"

他打开 Midjourney，输入"cyberpunk character"——结果？完全不是他想要的风格。

他尝试添加更多描述："neon lights, futuristic city, dark atmosphere"... 还是不对。

经过两小时沮丧的反复尝试，他放弃了。"我只是个营销专员，不是摄影师或艺术家。我怎么可能知道这些专业术语？"

**情节发展 - 发现**

三天后，Alex 在 Google 搜索"how to copy AI art style"，发现了 image_analyzer。

他来到网站，看到简洁的界面："上传参考图片，3 分钟获得专业提示词模版"

"3 分钟？" 他半信半疑，但决定试试...

**旅程过程**

1. **上传界面**：他拖拽上传了那张赛博朋克图片
   - 系统显示："正在分析风格...识别光影技巧...检测构图方法..."
   - 在 30-60 秒等待期间，他看到专业术语滚动显示——这建立了"这个工具很专业"的预期

2. **结果呈现（"顿悟时刻"）**
   - 左侧：他上传的参考图片
   - 中间：结构化的分析结果
     - 🎨 **光影**：伦勃朗光 + 霓虹边缘光
     - 📐 **构图**：黄金分割 + 低角度仰拍
     - 🌈 **色彩**：青橙色互补色配色 + 高饱和度
     - 🖼️ **艺术风格**：赛博朋克 + 电影感
   - 右侧：可编辑的模版预览
     ```
     Subject: [主体描述]
     Style: Cyberpunk aesthetic with Rembrandt lighting
     Composition: Golden ratio, low angle shot
     Colors: Cyan-orange complementary color scheme, high saturation
     Lighting: Neon edge lighting + dramatic shadows
     Additional: Futuristic city background, volumetric fog
     ```

3. **快速验证**
   - Alex 把"[主体描述]"替换成"D&D half-orc barbarian in armor"
   - 点击"生成图片"
   - 30 秒后...一张完美的赛博朋克风格兽人战士出现了！

4. **情感高潮**
   - Alex 盯着屏幕，不敢相信——"这正是我想要的！"
   - 他立刻保存了图片，然后分享到 Discord 社区
   - 朋友们惊叹："这太酷了！你是怎么做到的？"

**结局 - 转变**

一个月后，Alex 已经成为 Discord AI 绘画社区中小有名气的"风格大师"。

他建立了自己的风格库，存了 20+ 个不同的模版——从赛博朋克到水彩风，从电影感到动漫风格。

最重要的是：**他再也不会因为"不知道怎么描述"而放弃创意了。**

image_analyzer 不只是一个工具——它给了 Alex 表达创意的信心。

**旅程揭示的需求**
- 零门槛上传界面（拖拽上传，无需学习）
- 专业的分析展示（四维度卡片式呈现，建立信任）
- 可编辑的变量模版（清晰标记可替换部分）
- 一键生成集成（无缝调用图像生成模型的体验）
- 保存和分享功能（保存到本地，分享到社交媒体）
- 个人模版库（历史记录保存，支持收藏和管理）

---

### 旅程 2：专业设计师 - Sarah（高级用户路径）

**人物画像**
- **姓名**：Sarah
- **年龄**：32 岁
- **职业**：自由品牌设计师，服务于 3-4 个中小型客户
- **技能水平**：专业设计背景，懂摄影和色彩理论，对 AI 工具持谨慎态度
- **痛点**：客户经常发来竞品图片要求"类似风格"，但她需要手动拆解风格要素——费时且容易出错

**开篇场景 - 挑战**

一个周二上午，Sarah 的长期客户——一家有机茶品牌的市场经理发来邮件：

"Hi Sarah，我们看到了 Dazy 椰子奶的广告 campaign，很喜欢这种柔和、温暖、有手作感的风格。你能在下周前给我们出 3 个不同产品包装的 concept 吗？"

附件是一组精美的产品照片：柔和的自然光、浅木纹理背景、低饱和度的莫兰迪色系、手写风格的字体...

Sarah 叹了口气。作为专业设计师，她能看出这些风格要素：
- ☀️ 柔光箱光 + 自然窗光
- 📐 中心构图 + 微角度倾斜
- 🎨 莫兰迪配色 + 大量留白
- 🖼️ 手工艺风格 + 极简主义

但要把这些要素转换成 AI 绘画的提示词？她需要花 2-3 小时反复尝试...

**时间就是金钱。** 她需要一个能快速捕捉风格同时保持专业标准的工具。

**情节发展 - 专业的评估**

Sarah 在设计论坛上看到同行推荐 image_analyzer，决定试试——但她的期望比 Alex 高得多：

- "它能识别出莫兰迪色吗？"
- "它知道柔光箱光和自然光的区别吗？"
- "生成的提示词够专业吗？还是只是业余的描述？"

她带着**批判的眼光**来到网站...

**专业旅程**

1. **批量上传测试**
   - Sarah 上传了 3 张同风格的 Dazy 产品图片
   - 系统识别："检测到 3 张同风格图片，正在进行综合分析..."
   - **专业信号**：系统不是简单分析单张，而是**提取多张图片的共同特征**

2. **分析结果**
   - 🎨 **光影**：Softbox lighting + Northern window light + Subtle fill
   - 📐 **构图**：Central composition + Slight Dutch angle + Rule of thirds for product placement
   - 🌈 **色彩**：Morandi color scheme + Low saturation + Muted earth tones
   - 🖼️ **艺术风格**：Minimalist + Hand-crafted aesthetic + Japanese Zen influence

   Sarah 眉头一挑："嗯...Morandi？Japanese Zen？这些术语挺专业的。"

3. **可编辑模版**
   ```
   Product: [产品名称]
   Style: Minimalist product photography with Morandi color palette
   Composition: Central placement, shallow depth of field
   Colors: Muted earth tones (sage green, warm beige, soft terracotta), low saturation
   Lighting: Soft Northern window light from left, white reflector fill on right
   Background: Light wood texture with negative space
   Additional: Handmade ceramic props, subtle shadows, organic feel
   ```

4. **专业验证**
   - Sarah 把"[产品名称]"替换成"Organic chamomile tea tin"
   - 点击"生成"
   - 45 秒后...她看到生成的图片

   **关键时刻**：Sarah 凑近屏幕仔细检查...

   - ✅ 光线方向正确（左上软光）
   - ✅ 色彩确实是莫兰迪色系
   - ✅ 构图和留白恰当
   - ✅ 整体感觉温暖、手作感

   "好吧，"她想，"这个工具懂行。"

5. **效率提升**
   - Sarah 用模版快速生成了 3 个不同产品的 concept
   - 总耗时：**15 分钟**（以前需要 2-3 小时）
   - 她把这些发给客户，客户很满意

**结局 - 工作流集成**

三个月后，Sarah 已经把 image_analyzer 融入了她的工作流：

- **概念阶段**：用 image_analyzer 快速生成多个风格方案供客户选择
- **细化阶段**：基于客户反馈，微调模版生成变体
- **交付阶段**：用生成的图片作为参考，手工完成最终设计

**最重要的改变**：
- 她可以接更多项目了（效率提升 5 倍）
- 客户更满意了（快速看到视觉概念）
- 她有更多时间花在创意上，而不是机械性的风格拆解

**旅程揭示的需求**
- 批量上传分析（支持 3-5 张同风格图片进行综合分析，提高准确性）
- JSON 格式导出（专业用户需要结构化数据集成到工作流）
- 高精度分析模式（专业用户需要更详细、更精确的风格描述）
- 模型选择控制（专业用户可能想手动选择视觉模型）
- 历史记录管理（专业用户需要保存、分类和复用之前的模版）
- 品牌风格预设（未来）- 为企业客户保存品牌专属的风格配置

---

### 旅程 3：错误恢复 - Alex 的失败尝试（边缘情况）

**场景**

Alex 已经成为 image_analyzer 的忠实用户，已经用了 20+ 次。

今天，他上传了一张**超级复杂的图片**——漫威电影海报，包含：
- 多个人物
- 复杂的动态场景
- 爆炸特效
- 复合的光线条件

**系统响应：**
- 🎨 光影：[无法识别 - 场景过于复杂]
- 📐 构图：[建议使用单主体或静态场景图片]

Alex 感到困惑："我现在该怎么办？"

**错误恢复旅程**

**方案 A：用户教育**
- 系统显示友好的提示：
  > "这张图片有点复杂 😅
  >
  > 我们的工具最适合：
  > • 单个主体的人物/物体
  > • 静态场景或产品
  > • 清晰的风格特征
  >
  > 建议：尝试上传一张风格相似但更简单的图片，或者把图片裁剪到只保留你想复制的风格部分。"

- Alex 明白了，决定裁剪图片重新上传

**方案 B：降级处理**
- 如果用户坚持，系统仍然尝试分析但警告：
  > "我们会尽力分析，但结果可能不够准确。
  >
  > 继续吗？[取消][继续尝试]"

- 如果用户继续，系统给出**简化版分析**并标注置信度：
  - 🎨 光影：Dramatic movie lighting ⚠️ 60% confidence
  - 📐 构图：Dynamic action composition ⚠️ 50% confidence

**边缘情况揭示的需求**
- 智能输入验证（检测不适合的图片并给出友好提示）
- 用户教育机制（告诉用户工具的最佳使用场景）
- 图片裁剪工具（内置简单的裁剪功能，让用户可以直接在网站裁剪图片）
- 降级处理选项（对于复杂场景，提供简化分析但标注置信度）
- 清晰的错误信息（不只是显示错误，还要告诉用户**为什么**和**怎么办**）

### 旅程需求总结

三个用户旅程揭示了 MVP 的以下核心能力需求：

**核心能力**
1. **上传与输入管理**
   - 拖拽单张/批量上传（最多 5 张图片）
   - 图片验证，配合用户友好的错误信息
   - 可选的内置裁剪工具

2. **分析与呈现**
   - 四维度结构化分析（光影、构图、色彩、艺术风格）
   - 实时进度显示，配专业术语
   - 复杂场景的置信度指标
   - 批量图片综合分析

3. **模版生成与编辑**
   - 变量模版格式（清晰标记可替换部分）
   - JSON 格式导出选项
   - 一键复制到剪贴板

4. **图像生成集成**
   - 直接集成图像生成模型
   - 多模型提供商支持，用户可控
   - 快速验证工作流（生成 → 保存 → 分享）

5. **历史记录与库管理**
   - 30 天历史记录保存
   - 个人模版库，支持收藏
   - 搜索和分类功能

6. **错误处理与教育**
   - 智能输入验证
   - 友好的错误信息，提供可操作建议
   - 用户教育提示，告知最佳实践
   - 配合置信度评分的降级处理

基于用户旅程的核心需求，以下特定领域要求确保产品在合规性和技术约束下正常运行。

## 领域特定需求

### 合规与监管

**数据隐私（美国市场 - CCPA）：**
- 目标市场：美国为主（暂时不进入欧洲市场，避免 GDPR 合规成本）
- 数据最小化：用户上传的图片按订阅等级设置保留期限
  - 免费用户：30 天后自动删除
  - Standard 用户：90 天
  - 付费用户可选择延长保存期
- 用户数据访问和删除权（响应 CCPA 要求）

**AI 透明度义务：**
- 明确告知用户正在使用 AI 工具（透明度要求）
- 在 UI 上清晰标注"AI 驱动的分析"

**版权与使用条款：**
- 免责声明：用户上传图片时需确认拥有使用权利
- 用户需同意服务条款，声明：
  - 拥有上传图片的使用授权
  - 理解分析结果基于 AI 生成，不保证 100% 准确
  - 生成的模版和图片可自由商用（用户拥有生成内容的所有权）

**免费试用机制：**
- 新注册用户获赠 3 次免费试用积分
- 试用积分可用于完整的分析+生成流程
- 帮助用户体验产品价值后再决定付费

### 技术约束

**API 管理（Replicate 集成）：**
- 使用 Replicate API 作为统一的模型提供商聚合层
- 支持的模型类别：
  - **视觉模型**：通过 Replicate 接入 Qwen VL、GPT-4V、Gemini Pro Vision 等
  - **文字模型**：通过 Replicate 接入用于提示词优化的 LLM
  - **生图模型**：通过 Replicate 接入 Stable Diffusion、FLUX 等
- 每个模型类别设置速率限制和成本控制

**图片存储与隐私：**
- 免费用户：30 天自动删除
- Standard 用户：90 天
- 用户主动删除账户时，立即清除所有相关图片数据

**内容过滤（安全机制）：**
- 输入端关键词过滤：检测并拒绝包含不当内容的图片上传
- 输出端关键词过滤：检测并阻止生成包含以下内容的提示词：
  - 色情内容（nsfw, porn, explicit 等）
  - 暴力内容（violence, gore, blood 等）
  - 违法内容（illegal activity, drugs 等）
- 二次验证：对于边界情况，调用额外的安全检查 API

### 集成需求

**Replicate API 集成：**
- 统一的 API 调用层
- 错误处理和自动重试机制
- 成本监控和预算控制
- 模型切换能力（多提供商备份）

**数据流：**
用户上传 → 图片存储 → Replicate 视觉模型 → 提示词生成 → 用户编辑 → Replicate 生图模型 → 结果展示

### 风险与缓解

**风险 1：Replicate 服务中断**
- **暂不考虑**：MVP 阶段专注单一提供商，降低复杂度

**风险 2：API 成本超支**
- **缓解**：
  - Credit 订阅制（严格控制用量）
  - 用户级别用量上限
  - 实时成本监控
  - 免费用户获赠 3 次试用积分

**风险 3：不当内容生成**
- **缓解**：多层过滤机制
  - 输入端关键词过滤
  - 输出端关键词过滤
  - 可选的安全 API 二次验证

**风险 4：用户上传侵权图片**
- **缓解**：
  - 免责声明
  - 服务条款确认
  - 用户授权机制

**风险 5：分析质量不一致**
- **缓解**：
  - 用户反馈闭环
  - 持续优化提示词工程
  - 批量图片综合分析提高准确性

## 创新与新奇模式

### 检测到的创新领域

image_analyzer 代表**增量创新**（而非突破性创新），通过卓越执行、用户体验和技术集成创造价值：

**1. 执行质量创新**
- **10x 速度提升**：从竞品平均 30 分钟缩短至 3 分钟完成全流程
- **专业度突破**：将业余用户的描述能力提升到专业摄影师/艺术家水平
- **分析准确性**：批量图片综合分析提取共同特征，提高风格识别精度

**2. 用户体验创新**
- **零门槛上传**：拖拽式上传，无需任何专业知识
- **"震惊时刻"体验**：专业术语滚动显示 + 四维度结构化呈现建立信任
- **无缝验证工作流**：分析 → 编辑 → 生成 → 保存 → 分享一站式体验

**3. 技术集成创新**
- **三模型统一工作流**：
  - 视觉模型（图片理解）→ 文字模型（提示词优化）→ 生图模型（结果生成）
  - 通过 Replicate API 实现多提供商可扩展架构
  - 用户可手动切换每类模型的提供商
- **变量模版格式**：清晰标记可替换部分（如 `[主体描述]`），降低编辑门槛

**4. 渐进式框架演进**
- **四维度分析框架**（光影、构图、色彩、艺术风格）是起点而非终点
- **可扩展架构**：支持后续增加新维度、优化现有维度
- **数据驱动优化**：通过模版复用率和修改率持续改进分析质量

**5. 开源社区致谢**
- 可复用模版格式灵感来源于开源项目 [PromptFill](https://github.com/TanShilongMario/PromptFill)
- 体现对开源社区的尊重和知识共享精神

### 市场背景与竞争格局

**当前市场痛点**
- AI 绘画工具（Midjourney、Stable Diffusion）门槛高，需要专业提示词写作能力
- 普通用户无法准确描述风格要素（光影、构图、色彩理论）
- 专业设计师手动拆解风格耗时 2-3 小时

**image_analyzer 的差异化定位**
- **不是另一个 AI 生图工具**，而是**风格翻译器**
- **不依赖未经验证的突破性技术**，而是通过 UX 和集成创造 10x 体验
- **渐进式创新路径**：从简单提示词工程开始，基于用户反馈演变为 multi-agent 流程

**竞争优势来源**
1. **执行效率**：3 分钟 vs 竞品 30 分钟
2. **专业输出**：结构化四维度分析 vs 业余描述
3. **无缝集成**：一站式工作流 vs 多工具切换
4. **持续进化**：数据驱动的提示词工程优化 vs 静态模版

### 验证方法

**产品质量验证**
- **模版复用率 > 40%**：说明模版质量高，用户愿意重复使用
- **模版修改率 < 30%**：说明分析准确，用户可直接使用
- **分析成功率 > 95%**：API 调用成功返回结果的比例

**用户价值验证**
- **3 分钟完成全流程**：用户能快速获得可用结果
- **图片保存率 > 60%**：生成结果被用户保存
- **图片分享率 > 15%**：用户愿意分享（网络效应早期信号）

**商业价值验证**
- **7 天留存率 > 30%**：产品-市场匹配指标
- **NPS > 40**：用户推荐度（产品真正成功的早期信号）
- **5%+ 付费转化率**：用户认可产品价值并愿意付费

### 风险缓解

**风险 1：分析质量不一致**
- **缓解措施**：
  - 用户反馈闭环（模版修改率直接反映分析质量）
  - 批量图片综合分析（提高准确性）
  - 持续优化提示词工程（基于实际数据迭代）

**风险 2：竞品快速复制**
- **缓解措施**：
  - 专注执行质量和用户体验（难以复制的细节）
  - 建立用户数据飞轮（越多用户使用 → 分析越准确 → 竞争壁垒越高）
  - 渐进式演进（持续创新而非一次性突破）

**风险 3：提示词工程方法未完全确定**
- **缓解措施**：
  - MVP 采用简单提示词版本（快速验证核心价值）
  - 预留演进路径（6-18 个月优化，18 个月+ 评估 multi-agent）
  - 保持架构灵活性（支持切换和扩展模型提供商）

**风险 4：技术依赖单一提供商（Replicate）**
- **缓解措施**：
  - MVP 阶段专注单一提供商（降低复杂度）
  - 架构支持多提供商扩展（用户可手动切换）
  - 模型类别分离（视觉、文字、生图独立，降低依赖风险）

## Web 应用特定需求

### 项目类型概述

image_analyzer 是一个**单页应用（SPA）**，使用 Next.js 框架构建。目标用户主要为 AI 创作者，通过浏览器访问核心功能：上传参考图片、AI 风格分析、提示词模版生成与编辑、图片生成验证。

**关键特性：**
- 零门槛拖拽上传界面
- 实时分析进度反馈（智能轮询机制）
- 结构化结果展示与交互式编辑
- 一站式验证工作流

### 技术架构考虑

**前端框架：Next.js**

**选择 Next.js 的核心原因（按优先级）：**

1. **SSR 对 SEO 至关重要** ⭐
   - **营销落地页需要搜索引擎抓取**：产品主页、功能介绍、定价页面
   - **内容营销策略依赖 SEO**：博客文章、教程、案例研究需要被搜索引擎索引
   - **SEO 里程碑明确**：3 个月进入前 3 页，6 个月稳定首页（流量 > 10,000/月）
   - **SSR 是 SEO 的核心**：服务端渲染确保搜索引擎能完整抓取页面内容

2. **API Routes 简化架构**
   - 减少 MVP 需要维护的后端代码
   - 统一技术栈（前端 + 后端 API）

3. **全栈开发效率**
   - 一个技术栈覆盖前后端
   - 快速迭代能力

4. **React 生态成熟**
   - 丰富的组件库
   - 开发者社区支持强

**架构模式：**
- **营销页面（SSR）**：主页、功能介绍、定价、博客（SEO 优先）
- **核心应用（CSR）**：上传、分析、编辑、生成（用户体验优先）
- **混合渲染策略**：根据页面特性选择最优方案

### 响应式设计

**断点策略：**
- **桌面**（> 1024px）：主要体验，完整功能
- **平板**（768px - 1024px）：适配布局，功能完整
- **手机**（< 768px）：基础功能，简化布局

**移动端体验（MVP）：**
- 核心功能可用（上传、分析、查看结果）
- 复杂编辑功能可能需要横屏或建议使用桌面
- 不追求与桌面完全一致，但核心价值不受影响

### 性能目标：关键体验节点优先

**核心性能优先：**
- **分析结果展示**：< 1 秒（四维度卡片流畅渲染）
- **模版编辑响应**：< 100ms（输入无延迟感）
- **图片生成预览**：< 1 秒加载状态，< 5 秒显示进度（符合 Replicate API 现实）
- **上传进度显示**：必须显示上传进度（大文件可能需要 10+ 秒）
- 支持取消上传（用户控制权）

**未来优化方向（Growth）：**
- 首屏加载时间优化（代码分割、懒加载）
- API 响应缓存（减少重复请求）
- CDN 静态资源分发
- 分块上传、断点续传

### SEO 策略

**SEO 是核心获客渠道**

**SEO 里程碑：**
- 3 个月：核心关键词进入 Google 前 3 页
- 6 个月：核心关键词稳定首页，流量 > 10,000/月

**SSR 对 SEO 的价值：**
- ✅ **搜索引擎完整抓取**：服务端渲染确保页面内容被索引
- ✅ **Meta 标签优化**：动态生成每个页面的 title、description、og 标签
- ✅ **结构化数据**：Schema.org 标记提升搜索结果展示
- ✅ **核心网页指标**：SSR 有助于提升 Google Core Web Vitals 评分

**内容营销与 SEO 配合：**
- 教程文章（"如何复制 AI 艺术风格"）
- 案例研究（用户成功故事）
- 技术博客（提示词工程、AI 绘画技巧）
- 以上内容都需要 SEO 优化（SSR）

### 实时功能：智能轮询策略

**MVP 使用简单轮询（智能优化）**

**实现方案：**
- **开始阶段**：每 1 秒轮询（上传后快速响应）
- **分析阶段**：每 1-2 秒轮询（30-60 秒等待期，反馈必须及时）
- **超时保护**：60 秒后停止轮询（避免无限等待）
- **错误处理**：连续 3 次失败后提示用户（而非无限重试）

**轮询 vs 其他方案对比：**

| 方案 | 优点 | 缺点 | MVP 选择 |
|------|------|------|----------|
| **简单轮询** | 实现简单，无需额外基础设施 | 延迟较低，服务器负载 | ✅ MVP 采用（1-2秒频率） |
| **WebSocket** | 实时性强，双向通信 | 架构复杂，资源占用高 | ❌ Post-MVP |
| **Server-Sent Events (SSE)** | 单向推送，比 WebSocket 简单 | 仍需额外基础设施 | ⚠️ 可选升级路径 |

**进度显示设计：**
- 阶段 1：正在上传图片...
- 阶段 2：正在分析风格...识别光影技巧...检测构图方法...
- 阶段 3：生成提示词模版...
- 阶段 4：完成！

**未来优化（Growth）：**
- 考虑 SSE 或 WebSocket 减少延迟（用户抱怨延迟时）
- 优化轮询频率（动态调整）
- 用户离开页面时后台继续分析（通知用户返回）

### 无障碍访问：基础实现 + 可扩展

**MVP 阶段：基础无障碍（自然实现）**

**基础无障碍（自然实现）：**
- ✅ 键盘导航（使用标准 HTML 元素自然支持）
- ✅ 合理对比度（现代设计规范）
- ✅ 语义化 HTML（利于 SEO 和屏幕阅读器）

**未来考虑（Post-MVP）：**
- 🎯 **企业客户需求**：如果扩展到 B2B 市场，可能需要 WCAG 2.1 AA 合规
- 🎯 **差异化机会**：服务残障创作者，无障碍成为产品亮点
- 🎯 **用户反馈驱动**：根据实际用户需求决定投入程度

### 浏览器支持矩阵

**主浏览器支持：**
- ✅ **Chrome**（最新版本及前 2 个主版本）- **主支持（完整测试）**
  - 主要目标用户使用的浏览器
  - 开发和测试优先级最高
  - 支持 Chrome DevTools 调试特性

**次要支持（尽力而为）：**
- ⚠️ **Edge**（Chromium 内核版本）
- ⚠️ **Firefox**（最新版本）
- ⚠️ **Safari**（最新版本，macOS/iOS）

**不支持（明确告知）：**
- ❌ Internet Explorer（任何版本）
- ❌ 旧版本浏览器（2022 年以前）

**移动浏览器：**
- MVP 阶段：桌面体验优先，移动端响应式适配（基础功能可用）
- 未来考虑：移动端专属优化

### 实现考虑

**前端技术栈建议：**

**核心框架：**
- **Next.js**（React 框架）- **重点：SSR 用于 SEO 页面**
- **TypeScript**（类型安全）
- **Tailwind CSS** 或 **CSS Modules**（样式方案）

**状态管理：**
- **React Context** 或 **Zustand**（轻量级状态管理）
- **React Query**（API 请求和缓存）

**认证与授权：**
- **NextAuth.js**（Google OAuth 2.0 集成）
  - 支持 Google Provider（生产环境配置）
  - JWT 或 Session-based 认证
  - 用户数据存储（Email、姓名、头像）
  - 新用户自动获赠 3 次免费积分
  - Post-MVP 可扩展其他 Provider（GitHub、Email 等）

**UI 组件：**
- **Shadcn/ui** 或 **Radix UI**（无样式组件库，可定制性强）
- **React Dropzone**（拖拽上传）
- **Lucide React** 或 **Heroicons**（图标库）

**API 集成：**
- **Fetch API** 或 **Axios**（HTTP 客户端）
- **Replicate JavaScript SDK**（如果可用）或 REST API

**部署与基础设施：**
- **Vercel**（Next.js 原生支持，简化部署）
- **CDN**（静态资源分发）
- **图片存储**：S3 或类似服务（支持不同订阅等级的保留期限）

**开发优先级（MVP）：**
1. 核心功能实现（上传、分析、展示、编辑、生成）
2. 用户认证和授权
3. Credit 订阅系统集成
4. 历史记录管理
5. 错误处理和用户教育
6. **SEO 优化（SSR 营销页面）**

**不包含（MVP）：**
- ❌ PWA 功能（离线支持、安装到桌面）
- ❌ 国际化（i18n）
- ❌ A/B 测试框架

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

**MVP Approach:** Experience MVP - 优先实现"震惊时刻"用户体验
**Resource Requirements:** 1-2 名全栈开发者（6 个月 MVP 开发周期）

**MVP 理念：**
image_analyzer 采用 **Experience MVP** 策略 - 专注创造用户第一次使用时的"震惊时刻"（专业度超出预期的分析结果）。而非功能全面但平庸的体验。

**关键洞察：**
- 用户第一次看到结构化分析结果时的专业度 → 决定是否继续使用
- 3 分钟完成全流程（竞品需要 30 分钟） → 10x 速度提升
- JSON 导出对专业用户是 Deal-breaker → 区分"业余工具"与"专业工具"

### MVP Feature Set (Phase 1)

**Core User Journeys Supported:**
- ✅ 旅程 1：新手创作者 Alex - 成功路径（上传 → 分析 → 生成 → 保存）
- ✅ 旅程 2：专业设计师 Sarah - 批量分析路径（多张上传 → 综合分析 → JSON 导出）
- ✅ 旅程 3：错误恢复 - 边缘情况处理（复杂图片降级处理）

**Must-Have Capabilities (优先级排序):**

**P0 - 核心必需（决定成败）：**
1. ✅ Google 登录集成
   - NextAuth.js 实现 Google OAuth 2.0
   - 新用户自动获赠 30 credit（3 次使用）
   - 直接进入产品，无需额外注册步骤
2. ✅ 单张图片上传（核心交互）
   - 拖拽上传界面
   - 图片验证与错误提示
3. ✅ 智能风格分析
   - 光影、构图、色彩、艺术流派四大维度
   - 专业术语滚动显示（建立信任）
4. ✅ 结构化模版生成
   - JSON 格式（专业用户工作流集成）
   - 变量模版格式（清晰标记可替换部分）
5. ✅ 模版导出 - 复制到剪贴板（必需）
6. ✅ JSON 格式导出（专业用户 Deal-breaker）
7. ✅ 图像生成集成（验证闭环）
   - 至少 1 个生图模型提供商（通过 Replicate）
8. ✅ 接入视觉模型（至少 1 个提供商）

**P1 - 优化功能（MVP 可简化）：**
9. ⚠️ 批量上传（最多 5 张同风格图片，优先级降低）
10. ⚠️ 历史记录保存（简化版：最近 10 次分析）
11. ⚠️ 用户可手动切换模型提供商（技术灵活性）

**Credit 订阅制：**
- 详见 Functional Requirements FR42-43（三等级订阅：Free 30 credit，Lite 200 credit/$9.99/月，Standard 500 credit/$39/月）

### Post-MVP Features

**Phase 2 (Post-MVP):**

**Credit 系统扩展**
- Credit 包购买（订阅用户用完 credit 后可购买额外 credit 包）
  - 小包：10 次 credit - $4.99
  - 中包：25 次 credit - $9.99
  - 大包：50 次 credit - $14.99

**用户体验优化**
- 分析维度选择（用户可手动开启/关闭特定维度）
- 详细程度控制（简略/标准/详细三档输出）
- 历史记录保存（扩展到 90 天）

**内容与社区**
- UGC 营销机制（用户授权公开成功案例，获得 credit 奖励）
- Show Case 画廊（展示优秀案例）

**技术优化**
- 扩展更多模型提供商接入
- 提示词工程优化（基于用户反馈）

**Phase 3 (Expansion):**

**平台生态**
- 模版市场：用户可分享、收藏、交易风格模版
- 专业市场进入：面向设计工作室、广告公司的 B2B 版本
- 网络效应：模版越多 → 用户越多 → 模版更多...

**高级功能**
- API 访问（供开发者集成）
- 批量处理（高级功能）
- 品牌风格预设（企业级功能）
- 团队协作功能（Team 订阅，Enterprise 定制定价）
- Multi-agent 提示词工程流程（可选的升级版分析模式）

**技术护城河**
- 训练专用风格识别模型
- 支持分析参数控制（满足进阶用户需求）

### Risk Mitigation Strategy

**Technical Risks:**
- **风险：Replicate API 服务中断**
  - **缓解措施：** MVP 阶段专注单一提供商，降低复杂度。架构支持多提供商扩展（用户可手动切换）

- **风险：API 成本超支**
  - **缓解措施：** Credit 订阅制严格控制用量。实时成本监控。用户级别用量上限。

**Market Risks:**
- **风险：分析质量不一致**
  - **缓解措施：** 用户反馈闭环（模版复用率、修改率直接反映质量）。持续优化提示词工程。批量图片综合分析提高准确性。

- **风险：竞品快速复制**
  - **缓解措施：** 专注执行质量和用户体验（难以复制的细节）。建立用户数据飞轮（越多用户使用 → 分析越准确 → 竞争壁垒越高）。

**Resource Risks:**
- **风险：开发资源少于预期**
  - **缓解措施：** P1 优先级功能可延迟到 Post-MVP。MVP 专注 P0 核心必需功能。批量上传、历史记录可简化或移除。

基于上述项目范围定义，以下是功能需求规格说明。

## Functional Requirements

### 用户认证与管理

- **FR1**: 新用户可以通过 Google OAuth 登录创建账户
- **FR2**: 系统在新用户首次登录时自动授予 **30 credit**（相当于 3 次使用，每次 10 credit）
- **FR3**: 用户可以在登录后查看其当前 credit 余额和订阅状态
- **FR4**: 用户可以查看其基本账户信息
- **FR5**: 用户可以主动删除其账户

### 图片上传与输入管理

- **FR6**: 用户可以通过拖拽方式上传单张图片
- **FR7**: 用户可以批量上传最多 5 张同风格图片进行综合分析
- **FR8**: 系统可以验证上传图片的格式和大小
  - **支持格式**: JPEG、PNG、WebP（MVP）
  - **大小限制**: 单张图片最大 10MB
  - **分辨率限制**: 最小 200×200px，最大 8192×8192px
- **FR9**: 系统可以检测不适合分析的图片
  - **场景复杂度阈值**: 识别主体数量 > 5 个
  - **置信度阈值**: 分析置信度 < 50% 时警告用户
- **FR10**: 系统可以显示上传进度
- **FR11**: 用户可以取消正在进行的图片上传
- **FR12**: 系统可以为复杂图片提供降级分析选项并标注置信度
  - **置信度分级**:
    - 高: ≥80%
    - 中: 50-79%
    - 低: <50%
  - **触发条件**: 分析置信度 < 60% 时显示警告并提供重试选项
- **FR67**: 系统可以在批量分析时显示整体进度（如 "3/5 图片已分析完成"）

### 风格分析与处理

- **FR13**: 系统可以从上传的图片中提取四大维度的风格特征
  - **特征维度**: 光影、构图、色彩、艺术风格
  - **完整性指标**: 提取 10+ 个风格特征
  - **验证标准**: 每个维度置信度 > 50%
- **FR14**: 系统可以对多张同风格图片进行综合分析以提取共同特征
  - **置信度分级**:
    - 高: ≥80%（多图一致）
    - 中: 50-79%（部分一致）
    - 低: <50%（不一致）
  - **分析方法**: 综合多张图片的权重特征
- **FR15**: 系统可以在分析过程中显示实时进度和专业术语
- **FR16**: 系统可以调用至少一个视觉模型提供商进行图片理解
- **FR17**: 用户可以手动选择视觉模型提供商
- **FR18**: 系统可以将风格特征组织成结构化的分析结果
  - **JSON 格式**: `{color, composition, lighting, style, mood}`
  - **验证标准**: 每个字段置信度 > 50%
  - **可扩展**: 支持自定义字段
- **FR76**: 系统可以在检测到低置信度分析时主动警告用户并提供重试选项
- **FR74**: 用户可以对分析结果提供质量反馈
  - **反馈选项**: 准确 / 部分准确 / 不准确
  - **激励机制**: 有效反馈奖励 5 credits
  - **参与率目标**: 用户反馈参与率 > 20%
  - **反馈利用**: 用于模型性能监控和改进

### 模版生成与编辑

- **FR19**: 系统可以根据风格特征生成可编辑的变量模版
- **FR20**: 系统可以生成 JSON 格式的模版供专业用户集成工作流
- **FR21**: 系统可以在模版中清晰标记可替换的变量部分(如 `[主体描述]`)
- **FR22**: 用户可以编辑生成的模版内容
- **FR23**: 用户可以将模版复制到剪贴板
- **FR24**: 用户可以导出 JSON 格式的模版文件
- **FR25**: 系统可以调用文字模型提供商优化提示词
- **FR65**: 用户可以在分析结果页面选择将特定模版保存到个人模版库

### 图像生成集成

- **FR26**: 用户可以基于编辑后的模版直接生成同风格图片
- **FR27**: 系统可以调用至少一个生图模型提供商生成图片
- **FR28**: 用户可以手动选择生图模型提供商
- **FR29**: 用户可以查看生成的图片结果
- **FR30**: 用户可以保存生成的图片到本地设备（PNG 格式）
- **FR31**: 系统可以展示图片生成的进度状态
- **FR32**: 用户可以将生成的图片分享到 **X (Twitter)**（MVP），其他平台使用通用分享功能
- **FR72**: 用户**首次分享**生成的图片到社交媒体可获得 **6 credit** 奖励
- **FR73**: 用户**后续分享**生成的图片到社交媒体每次可获得 **2 credit** 奖励
- **FR82**: **Standard** 订阅用户可以享受**更高的图片生成分辨率**

### 历史记录与库管理

- **FR33**: 系统可以保存用户最近的 **10 次分析记录**（临时历史记录）
- **FR34**: 用户可以浏览其历史分析记录
- **FR35**: 用户可以查看历史记录中的分析结果和模版
- **FR36**: 用户可以基于历史记录中的模版创建新的分析

### 模版库管理（永久保存）

- **FR37**: 用户可以将分析生成的模版**永久保存**到个人模版库
- **FR38**: 用户可以收藏/标记特定的模版以便快速访问
- **FR39**: 用户可以基于收藏的模版**一键重新生成**图片（使用相同模版生成新的同风格图片）
- **FR40**: 用户可以为模版添加自定义标签或分类
  - **标签数量**: 单个模版最多 10 个标签
  - **分类层级**: 支持两级分类（父分类/子分类）
  - **标签长度**: 每个标签最多 20 个字符
- **FR69**: 用户可以查看其使用模版生成的**所有历史图片**
  - **告警阈值**: 错误率 > 5% 触发告警
  - **响应时间**: 告警响应时间 < 5 分钟
  - **监控指标**: 模版使用次数、成功率、平均生成分辨率
  - **统计维度**: 按时间、按模版、按模型分类统计
- **FR70**: 用户可以查看每个模版的**使用次数统计**（了解哪些模版最有价值）

### 订阅与计费管理

- **FR42**: 系统支持 Free 等级用户登录后自动获赠 30 credit（3 次使用）
- **FR43**: 系统支持多等级订阅：
  - **Lite 订阅**：
    - 月度：200 credit/月（20 次使用）= $9.99/月，**不滚存**
    - 年度：2400 credit/年 = $99/年（相当于 200 credit/月），**不滚存**
  - **Standard 订阅**：
    - 月度：500 credit/月（50 次使用）= $39/月，**不滚存**
    - 年度：6000 credit/年 = $399/年（相当于 500 credit/月），**不滚存**
- **FR44**: 用户可以订阅 Lite 月度计划($9.99/月，200 credit)或 Lite 年度计划($99/年，2400 credit)
- **FR45**: 用户可以订阅 Standard 月度计划($39/月，500 credit)或 Standard 年度计划($399/年，6000 credit)
- **FR46**: 系统可以在**分析成功后**扣除相应的 credit（每次分析扣除 10 credit，确保事务性）
- **FR47**: 用户可以在 credit 不足时收到升级提示，并在完成订阅后自动恢复被中断的操作
- **FR48**: 系统可以跟踪用户的订阅状态和计费周期
- **FR49**: 用户可以查看其 credit 充值和消费历史明细
  - **保留期限**: 交易记录保留 180 天
  - **显示内容**: 时间、类型（充值/消费）、金额、余额、关联操作
  - **导出功能**: 支持 CSV 格式导出
- **FR80**: **Standard** 订阅用户可以享受**优先队列**（分析请求优先处理）
- **FR81**: **Standard** 订阅用户可以获得**更详细的分析维度**（如新增"情感基调"、"艺术时期"等）

### 性能与可靠性

- **FR78**: 系统可以在分析超时后**将任务加入后台队列**，完成后通过浏览器通知或邮件通知用户
- **FR79**: 系统可以显示当前等待队列中的任务数量（透明化等待时间）

### 合规与内容安全

- **FR50**: 用户在上传图片前需确认拥有使用权利
- **FR51**: 用户在首次使用时需同意服务条款(声明拥有上传图片授权、理解 AI 分析局限性、拥有生成内容所有权)
- **FR52**: 系统可以检测并拒绝包含不当内容的图片上传
  - **过滤类别**: 暴力内容、成人内容、仇恨言论、危险活动
  - **检测准确率**: > 99% 检测率
  - **误报率**: < 0.1% 合规内容被误判
  - **响应时间**: 内容检查延迟 < 200ms
- **FR53**: 系统可以检测并阻止生成包含不当内容的提示词
  - **过滤类别**: 暴力内容、成人内容、仇恨言论、危险活动
  - **准确率**: > 99% 检测率
  - **误报率**: < 0.1% 误判率
  - **响应时间**: 过滤延迟 < 200ms
- **FR54**: 系统可以在 UI 上清晰标注"AI 驱动的分析"(AI 透明度)
- **FR55**: 系统可以按照用户订阅等级自动删除过期的图片数据(Free 用户 30 天,Standard 用户 90 天)
- **FR56**: 系统可以在用户删除账户时立即清除所有相关图片数据

### 错误处理与用户支持

- **FR57**: 系统可以为上传失败提供友好的错误信息和可操作建议
  - **错误信息包含**: 失败原因、建议操作步骤、截图示例、帮助链接
  - **可理解性**: 用户理解率 > 90%（通过用户测试验证）
  - **格式**: 结构化错误码 + 自然语言说明
- **FR58**: 系统可以为分析失败提供友好的错误信息和可操作建议
  - **错误信息包含**: 失败原因（如图片复杂、API 超时）、建议重试或调整图片、联系支持选项
  - **可理解性**: 用户理解率 > 90%（通过用户测试验证）
  - **恢复引导**: 提供"重试"、"调整图片"、"联系支持"三个操作选项
- **FR59**: 系统可以为图片生成失败提供友好的错误信息和可操作建议
  - **错误信息模板**: "图片生成失败：[原因]。建议：[具体操作]。如需帮助，[联系方式]"
  - **原因分类**: API 超时、内容违规、配额不足、模型错误
  - **可操作建议**: 每种原因提供具体解决步骤
- **FR60**: 系统可以告知用户工具的最佳使用场景
  - **推荐场景**: 单主体、静态场景、清晰风格特征
  - **不推荐场景**: 多主体（>5个）、动态场景、模糊图像
  - **成功率指标**: 推荐场景成功率 > 90%，不推荐场景成功率 < 60%
  - **用户教育**: 首次使用时显示场景引导
- **FR61**: 系统可以在 API 调用失败时进行自动重试(最多 3 次)
- **FR62**: 系统可以在分析超时(60 秒)后停止轮询并提示用户
- **FR63**: 系统可以显示上传进度
- **FR64**: 系统可以显示图片生成进度

### 系统配置与扩展性

- **FR68**: 管理员可以配置启用/禁用不同的模型提供商
  - **认证要求**: 管理员需要 2FA + 角色权限审批
  - **配置范围**: 模型提供商开关、API 密钥、优先级
  - **审计日志**: 所有配置变更记录日志（操作人、时间、变更内容）

---

**功能需求总数**: **79 个**

以上功能需求定义了系统的能力契约，以下非功能需求规定了系统的质量属性标准。

## Non-Functional Requirements

### Performance（性能）

**NFR-PERF-1: 分析响应时间**
- 系统必须在 **95% 的分析请求**中在 **60 秒内**完成风格分析
- **度量**：P95 延迟 < 60 秒
- **理由**：用户旅程显示 30-60 秒等待期是可接受的

**NFR-PERF-2: 实时进度反馈**
- 系统必须在分析过程中每 **1-2 秒**更新一次进度状态
- **度量**：进度更新间隔 ≤ 2 秒
- **理由**：FR15 要求实时进度显示

**NFR-PERF-3: 图片生成响应**
- 用户点击生成后 **< 1 秒**显示加载状态
- **< 5 秒**显示生成进度（Replicate API 现实）
- **度量**：首字节响应时间 < 500ms
- **理由**：用户期待即时反馈

**NFR-PERF-4: 模版编辑响应**
- 用户编辑模版时的输入延迟必须 **< 100ms**
- **度量**：输入响应时间 < 100ms
- **理由**：FR22 要求无延迟感

**NFR-PERF-5: 批量分析进度**
- 系统必须显示批量分析的整体进度（如 "3/5 已完成"）
- **度量**：进度更新实时性
- **理由**：FR67 要求批量分析整体进度

### Security（安全）

**NFR-SEC-1: 数据加密**
- 所有用户数据在**传输中**必须使用 **TLS 1.3** 加密
- 所有敏感数据在**静态存储**必须使用 **AES-256** 加密
- **理由**：保护用户隐私和支付信息

**NFR-SEC-2: 身份认证**
- 用户认证必须使用 **OAuth 2.0**（Google Provider）
- 会话 Token 有效期不超过 **7 天**
- **理由**：FR1-2 使用 Google OAuth

**NFR-SEC-3: 授权控制**
- 用户只能访问**自己的数据**（图片、模版、历史记录）
- 管理员配置功能需要**额外授权**
- **理由**：FR68 管理员配置

**NFR-SEC-4: 支付安全**
- 支付处理必须符合 **PCI-DSS Level 1** 标准
- 不存储完整的信用卡号
- **理由**：FR44-45 订阅计费

**NFR-SEC-5: 内容过滤**
- 系统必须在**输入端和输出端**过滤不当内容
- 必须支持**二次验证**机制
- **理由**：FR52-53 内容过滤要求

**NFR-SEC-6: 数据隐私（CCPA 合规）**
- 用户数据保留期限：
  - Free 用户：**30 天**
  - Lite/Standard 用户：**90 天**
- 用户可以请求**数据访问和删除**
- UI 显示数据保留期限，无需额外通知
- **理由**：CCPA 合规要求

### Scalability（可扩展性）

**NFR-SCALE-1: 用户增长支持**
- 系统必须支持 **10 倍用户增长**（从 100 到 1,000 用户）
- 性能下降不超过 **10%**
- **度量**：并发用户数 × 10，响应时间增加 < 10%
- **理由**：第一年目标 100 付费用户，长期需要扩展

**NFR-SCALE-2: 流量突发支持**
- 系统必须承受 **3 倍日常流量**的突发（如病毒式内容分享）
- **度量**：峰值流量 = 3 × 平均流量
- **理由**：SEO 目标 10K/月，可能有内容营销带来的流量激增

**NFR-SCALE-3: 数据存储扩展**
- 系统必须支持存储 **100,000 张图片**（假设每用户平均 100 张）
- **度量**：存储容量规划
- **理由**：图片数据增长

**NFR-SCALE-4: 队列管理**
- 系统必须支持 **最多 100 个并发分析任务**在队列中
- 队列长度透明化（FR79）
- **理由**：FR78-79 后台队列和队列透明化

**NFR-SCALE-5: Credit 事务处理**
- 系统必须支持 **每秒 100 次 credit 扣除操作**
- 确保**原子性**（FR46）
- **理由**：FR46 事务性 credit 扣除

### Concurrency（并发控制）

**NFR-CONCURRENCY: 并发处理数限制**
- **Free 用户**：同时最多 **1 个**分析任务
- **Lite 用户**：同时最多 **3 个**分析任务
- **Standard 用户**：同时最多 **10 个**分析任务
- 超过限制时返回 **503 Service Unavailable** 并提示用户
- **理由**：差异化订阅权益，保护系统稳定性

### Integration（集成）

**NFR-INT-1: Replicate API 集成**
- 系统必须支持至少 **3 个模型类别**的提供商（视觉、文字、生图）
- API 调用失败时自动重试 **最多 3 次**（FR61）
- **理由**：核心技术依赖

**NFR-INT-2: Google OAuth 集成**
- 系统必须支持 **Google OAuth 2.0** 协议
- 支持获取用户基本信息（Email、姓名、头像）
- **理由**：FR1 用户认证

**NFR-INT-3: 社交分享集成**
- 系统必须支持 **X (Twitter) API** 进行图片分享
- 支持通用 **Web Share API**（fallback 机制）
- **理由**：FR32 社交分享

**NFR-INT-4: 支付网关集成**
- 系统必须集成主流支付网关（如 Stripe、PayPal）
- 支持月度和年度订阅计费
- **理由**：FR44-45 订阅计费

**NFR-INT-5: 存储服务集成**
- 系统必须集成云存储服务（如 AWS S3、Vercel Blob）
- 支持按订阅等级设置不同的数据保留期限
- **理由**：图片存储需求

### Reliability（可靠性）

**NFR-REL-1: 可用性**
- 系统可用性目标：**99.5%**（每月约 3.6 小时停机）
- **度量**：(总时间 - 停机时间) / 总时间
- 计划维护必须在非高峰时段（美国时间凌晨 2-6 点）
- **理由**：SaaS 产品标准

**NFR-REL-2: API 调用成功率**
- Replicate API 调用返回**可用结果**的比率必须 **> 95%**
- 包括重试机制（FR61）
- **度量**：成功调用数 / 总调用数
- **理由**：成功指标要求

**NFR-REL-3: 错误恢复**
- 系统必须在 API 调用失败后自动重试 **最多 3 次**
- 必须提供友好的错误信息（FR57-59）
- **理由**：FR61 自动重试

**NFR-REL-4: 数据持久性**
- 用户模版库数据必须 **99.99%** 不丢失
- 图片数据按订阅等级保留
- **理由**：模版库是永久保存的（FR37）

**NFR-REL-5: 超时处理**
- 分析请求在 **60 秒**后必须停止轮询并提示用户（FR62）
- 支持后台队列继续处理（FR78）
- **理由**：用户体验和资源管理

**NFR-REL-6: 高并发优雅降级**
- 当系统达到并发处理限制时，返回 **503 Service Unavailable**
- UI 显示友好的 **'服务器繁忙，请稍后再试'** 消息
- 系统必须支持 **后台队列**（FR78 已覆盖）
- 用户可以选择 **加入等待队列** 或 **稍后重试**
- **理由**：保护系统稳定性，提供良好的用户体验

---

**非功能需求总数**: **28 个**
